<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nexura - European Market Strategy Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#F3F3F4;--card:#FFFFFF;--cardAlt:#F7F7F8;--border:#E0E0E4;--borderLight:#EBEBEE;
  --text:#2C2C32;--textMed:#5C5C64;--textMuted:#88888E;--textLight:#AAABB0;
  --accent:#8E3C3C;--accentSoft:#F5EAEA;--warm:#B06868;--warmSoft:#F8EDED;
  --coral:#D0A0A0;--coralSoft:#FAF2F2;--navy:#8E3C3C;--navySoft:#F5EAEA;
  --plum:#B06868;--plumSoft:#F8EDED;--sand:#D0A0A0;--stone:#88888E;
  --font:'DM Sans',sans-serif;--display:'Playfair Display',serif;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--font);background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}

/* LOGIN */
#loginPage{position:fixed;inset:0;background:linear-gradient(135deg,#8E3C3C 0%,#B06868 50%,#D0A0A0 100%);display:flex;align-items:center;justify-content:center;z-index:9999;transition:opacity 0.6s,transform 0.6s}
#loginPage.hidden{opacity:0;pointer-events:none;transform:scale(1.05)}
.login-card{background:#fff;border-radius:20px;padding:48px 40px;width:400px;box-shadow:0 30px 80px rgba(0,0,0,0.3);text-align:center;animation:slideUp 0.8s ease}
@keyframes slideUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
.login-card h1{font-family:var(--display);font-size:28px;color:var(--navy);margin-bottom:4px}
.login-card .subtitle{font-size:13px;color:var(--textMuted);margin-bottom:32px;letter-spacing:0.03em}
.login-card .logo-icon{width:64px;height:64px;background:var(--accent);border-radius:16px;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;font-size:28px;color:#fff;font-weight:700;font-family:var(--display)}
.login-field{position:relative;margin-bottom:16px;text-align:left}
.login-field label{display:block;font-size:11px;font-weight:600;color:var(--textMuted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:6px}
.login-field input{width:100%;padding:12px 16px;border:1.5px solid var(--border);border-radius:10px;font-size:14px;font-family:var(--font);background:var(--cardAlt);transition:all 0.3s;outline:none}
.login-field input:focus{border-color:var(--accent);background:#fff;box-shadow:0 0 0 3px var(--accentSoft)}
.login-btn{width:100%;padding:14px;background:var(--accent);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:600;font-family:var(--font);cursor:pointer;transition:all 0.3s;margin-top:8px}
.login-btn:hover{background:#B06868;transform:translateY(-1px);box-shadow:0 6px 20px rgba(142,60,60,0.3)}
.login-error{color:var(--coral);font-size:12px;margin-top:12px;display:none}
.login-hint{font-size:11px;color:var(--textLight);margin-top:20px}

/* DASHBOARD */
#dashboard{display:none;opacity:0;transition:opacity 0.6s}
#dashboard.visible{display:block;opacity:1}
.header{background:#fff;border-bottom:1px solid var(--border);padding:14px 44px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px)}
.header-left{display:flex;align-items:center;gap:12px}
.header-logo{width:36px;height:36px;background:var(--accent);border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-family:var(--display);font-size:16px}
.header-title{font-family:var(--display);font-size:18px;color:var(--navy)}
.header-sub{font-size:11px;color:var(--textLight);letter-spacing:0.03em}
.logout-btn{padding:6px 16px;border:1px solid var(--border);border-radius:6px;background:none;font-size:11px;font-weight:600;color:var(--textMuted);cursor:pointer;font-family:var(--font);transition:all 0.2s}
.logout-btn:hover{background:var(--coralSoft);color:var(--coral);border-color:var(--coral)}

/* TABS */
.tab-bar{display:flex;gap:6px;padding:12px 44px;background:var(--cardAlt);border-bottom:1px solid var(--border);overflow-x:auto;flex-wrap:wrap}
.tab-btn{padding:7px 16px;border-radius:7px;border:1px solid transparent;cursor:pointer;font-size:12px;font-weight:600;background:transparent;color:var(--textMuted);font-family:var(--font);transition:all 0.2s;white-space:nowrap}
.tab-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.tab-btn:hover:not(.active){background:var(--card);border-color:var(--border)}

/* CONTENT */
.content{max-width:1200px;margin:0 auto;padding:24px 44px 60px}
.tab-content{display:none}
.tab-content.active{display:block;animation:fadeIn 0.4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* COMPONENTS */
.box{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px 24px;margin-bottom:20px}
.box-title{font-family:var(--display);font-size:16px;font-weight:700;color:var(--text);margin-bottom:4px}
.box-sub{font-size:11px;color:var(--textLight);margin-bottom:14px}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:14px;margin-bottom:24px}
.kpi{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 20px}
.kpi-title{font-size:10px;font-weight:600;color:var(--textLight);text-transform:uppercase;letter-spacing:0.06em}
.kpi-value{font-size:24px;font-weight:700;margin:4px 0 2px}
.kpi-sub{font-size:11px;color:var(--textMuted)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:24px}
.grid-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:14px;margin-bottom:24px}
.grid-5{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;gap:12px;margin-bottom:24px}

/* TABLE */
table{width:100%;border-collapse:collapse}
th{font-size:11px;font-weight:600;color:var(--textMuted);text-transform:uppercase;letter-spacing:0.04em;padding:10px 12px;border-bottom:2px solid var(--border);text-align:left}
th.right{text-align:right}
td{font-size:13px;padding:10px 12px;border-bottom:1px solid var(--borderLight)}
td.right{text-align:right}
td.bold{font-weight:700}
tr.alt{background:var(--cardAlt)}
tr.total{background:var(--accentSoft);font-weight:700}

/* CARDS */
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px 16px}
.stat-card.accent-top{border-top:3px solid var(--accent)}
.stat-card.warm-top{border-top:3px solid var(--warm)}
.stat-card.coral-top{border-top:3px solid var(--coral)}
.stat-card.navy-top{border-top:3px solid var(--navy)}
.stat-card.plum-top{border-top:3px solid var(--plum)}
.left-border{border-left:4px solid}
.accent-border{border-left-color:var(--accent)}
.warm-border{border-left-color:var(--warm)}
.coral-border{border-left-color:var(--coral)}
.navy-border{border-left-color:var(--navy)}
.plum-border{border-left-color:var(--plum)}
.sand-border{border-left-color:var(--sand)}

/* CHART */
.chart-container{position:relative;height:300px;margin:10px 0}
.chart-container.small{height:240px}

/* PILLS */
.pill{display:inline-block;font-size:11px;padding:3px 10px;border-radius:12px;font-weight:500;margin:2px 4px 2px 0}
.pill.plum{background:var(--plumSoft);color:var(--plum)}
.pill.accent{background:var(--accentSoft);color:var(--accent)}
.pill.warm{background:var(--warmSoft);color:var(--warm)}

/* COLORS */
.c-accent{color:var(--accent)}.c-warm{color:var(--warm)}.c-coral{color:var(--coral)}.c-navy{color:var(--navy)}.c-plum{color:var(--plum)}.c-sand{color:var(--sand)}.c-muted{color:var(--textMuted)}.c-light{color:var(--textLight)}
.bg-accent{background:var(--accentSoft)}.bg-warm{background:var(--warmSoft)}.bg-coral{background:var(--coralSoft)}.bg-navy{background:var(--navySoft)}.bg-plum{background:var(--plumSoft)}

/* TYPOGRAPHY */
p{font-size:13px;line-height:1.7;color:var(--textMed);margin-bottom:10px}
strong,.b{font-weight:700;color:var(--text)}
.ul{list-style:none;padding:0}
.ul li{font-size:13px;color:var(--textMed);padding:5px 0;padding-left:16px;position:relative;line-height:1.6}
.ul li::before{content:">";position:absolute;left:0;color:var(--accent);font-weight:700;font-size:11px}

/* METRIC BAR */
.metric-bar{display:flex;align-items:flex-end;gap:16px;justify-content:center;padding:20px 0}
.metric-col{text-align:center;flex:1}
.metric-bar-fill{border-radius:8px 8px 0 0;display:flex;align-items:flex-end;justify-content:center;padding-bottom:4px;transition:height 0.5s;margin:0 auto;width:60px}
.metric-label{background:var(--cardAlt);border:1px solid var(--border);border-radius:0 0 8px 8px;padding:8px 4px}

/* PHASE TIMELINE */
.timeline-item{display:flex;gap:16px;padding:16px 0;border-bottom:1px solid var(--borderLight)}
.timeline-item:last-child{border-bottom:none}
.timeline-num{min-width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:16px;flex-shrink:0}
.timeline-content{flex:1}
.timeline-title{font-size:15px;font-weight:700;margin-bottom:4px}
.timeline-tag{font-size:11px;color:var(--textLight);background:var(--cardAlt);padding:2px 10px;border-radius:12px;float:right}

/* ROLE ROW */
.role-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--borderLight)}
.role-dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:8px}
.role-badge{font-size:11px;padding:2px 8px;border-radius:4px}
.role-salary{font-size:12px;font-weight:600;color:var(--textMed);min-width:70px;text-align:right}

/* DEPT CARD */
.dept-card{background:#fff;border:1px solid var(--border);border-radius:10px;padding:16px 20px}
.dept-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.dept-name{font-size:14px;font-weight:700}
.dept-count{font-size:20px;font-weight:700}

/* VALUATION CARD */
.val-card{border-radius:8px;padding:10px 12px;text-align:center;color:#fff}
.val-card .label{font-size:10px;font-weight:600;opacity:0.8}
.val-card .value{font-size:20px;font-weight:700}
.val-card .mult{font-size:10px;opacity:0.8}

/* PILLAR */
.pillar{border-radius:12px;padding:20px;text-align:center}
.pillar-num{font-size:36px;font-weight:700;margin-bottom:8px}
.pillar-title{font-size:15px;font-weight:700;margin-bottom:8px}

/* FOOTER */
.footer{border-top:1px solid var(--border);padding:20px 44px;text-align:center;background:var(--cardAlt);font-size:11px;color:var(--textLight)}

/* RESPONSIVE */
@media(max-width:900px){
  .grid-2,.grid-3,.grid-4,.grid-5{grid-template-columns:1fr}
  .content{padding:16px 20px 40px}
  .header{padding:14px 20px}
  .tab-bar{padding:10px 20px}
}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="login-card">
    <div class="logo-icon">N</div>
    <h1>Nexura</h1>
    <div class="subtitle">Nexura - AI-Powered Proptech Agency</div>
    <div class="login-field">
      <label>Username</label>
      <input type="text" id="username" placeholder="Enter username" autocomplete="off">
    </div>
    <div class="login-field">
      <label>Password</label>
      <input type="password" id="password" placeholder="Enter password" autocomplete="off">
    </div>
    <button class="login-btn" onclick="doLogin()">Sign In</button>
    <div class="login-error" id="loginError">Invalid username or password</div>
    <div class="login-hint">Contact admin for access credentials</div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <div class="header">
    <div class="header-left">
      <div class="header-logo">N</div>
      <div>
        <div class="header-title">Nexura</div>
        <div class="header-sub">AI-Powered Proptech Agency - European Market Strategy</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:16px">
      <div style="display:flex;gap:10px">
        <div style="background:var(--accentSoft);border:1px solid #8E3C3C22;border-radius:10px;padding:10px 18px;text-align:center">
          <div style="font-size:10px;color:var(--accent);font-weight:700;letter-spacing:0.06em">5-YEAR REVENUE</div>
          <div style="font-size:18px;font-weight:700;color:var(--accent)" id="headerRev"></div>
        </div>
        <div style="background:var(--warmSoft);border:1px solid #B0686822;border-radius:10px;padding:10px 18px;text-align:center">
          <div style="font-size:10px;color:var(--warm);font-weight:700;letter-spacing:0.06em">5-YEAR EBITDA</div>
          <div style="font-size:18px;font-weight:700;color:var(--warm)" id="headerEbitda"></div>
        </div>
      </div>
      <button class="logout-btn" onclick="doLogout()">Sign Out</button>
    </div>
  </div>

  <div class="tab-bar" id="tabBar"></div>

  <div class="content" id="contentArea"></div>

  <div class="footer">Nexura - AI-Powered Proptech Agency - European Market Strategy - Confidential</div>
</div>

<script>
// ===== AUTH =====
const VALID_USER = 'admin';
const VALID_PASS = 'nexura2025';

function doLogin(){
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value;
  if(u === VALID_USER && p === VALID_PASS){
    document.getElementById('loginPage').classList.add('hidden');
    const db = document.getElementById('dashboard');
    db.style.display = 'block';
    setTimeout(()=> db.classList.add('visible'), 50);
    sessionStorage.setItem('auth','1');
    initDashboard();
  } else {
    document.getElementById('loginError').style.display = 'block';
    document.getElementById('password').value = '';
  }
}
function doLogout(){
  sessionStorage.removeItem('auth');
  location.reload();
}
document.getElementById('password').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });
document.getElementById('username').addEventListener('keydown', e => { if(e.key==='Enter') document.getElementById('password').focus(); });

// Auto-login if session active
if(sessionStorage.getItem('auth')==='1'){
  document.getElementById('loginPage').style.display='none';
  const db = document.getElementById('dashboard');
  db.style.display='block';db.classList.add('visible');
  window.addEventListener('DOMContentLoaded', initDashboard);
}

// ===== DATA =====
const fiveYear=[
  {year:"Year 1",yr:"Y1",projects:5,revenue:2287000,costs:400000,ebitda:1887000,margin:83,team:4,successFees:1917000,onboarding:140000,saas:50000,retainer:159000,mediaMgmt:21000},
  {year:"Year 2",yr:"Y2",projects:15,revenue:6900000,costs:1090000,ebitda:5810000,margin:84,team:10,successFees:5781000,onboarding:435000,saas:136000,retainer:481000,mediaMgmt:67000},
  {year:"Year 3",yr:"Y3",projects:50,revenue:25684000,costs:3350000,ebitda:22334000,margin:87,team:30,successFees:21682000,onboarding:1590000,saas:451000,retainer:1716000,mediaMgmt:245000},
  {year:"Year 4",yr:"Y4",projects:100,revenue:55040000,costs:6500000,ebitda:48540000,margin:88,team:60,successFees:46620000,onboarding:3400000,saas:895000,retainer:3600000,mediaMgmt:525000},
  {year:"Year 5",yr:"Y5",projects:150,revenue:85733000,costs:10440000,ebitda:75293000,margin:88,team:95,successFees:72698000,onboarding:5325000,saas:1325000,retainer:5560000,mediaMgmt:825000},
];
const cumRev=fiveYear.reduce((s,d)=>s+d.revenue,0);
const cumEbitda=fiveYear.reduce((s,d)=>s+d.ebitda,0);
const cumCosts=fiveYear.reduce((s,d)=>s+d.costs,0);
const y5=fiveYear[4];

const projectMix=[{year:"Y1",small:3,medium:2,large:0,villa:0},{year:"Y2",small:7,medium:5,large:1,villa:2},{year:"Y3",small:18,medium:20,large:5,villa:7},{year:"Y4",small:30,medium:40,large:15,villa:15},{year:"Y5",small:40,medium:55,large:30,villa:25}];
const teamData=[{year:"Y1",Leadership:1,AcctMgmt:0,Creative:1,Marketing:1,Tech:1,Sales:0,Ops:0},{year:"Y2",Leadership:2,AcctMgmt:2,Creative:2,Marketing:2,Tech:1,Sales:1,Ops:0},{year:"Y3",Leadership:3,AcctMgmt:10,Creative:5,Marketing:5,Tech:3,Sales:2,Ops:2},{year:"Y4",Leadership:5,AcctMgmt:20,Creative:10,Marketing:10,Tech:6,Sales:5,Ops:4},{year:"Y5",Leadership:6,AcctMgmt:32,Creative:16,Marketing:16,Tech:10,Sales:8,Ops:7}];
const costBreak=[{year:"Y1",Team:280000,AITools:30000,Hosting:10000,Operations:60000,Freelancers:20000},{year:"Y2",Team:750000,AITools:60000,Hosting:30000,Operations:150000,Freelancers:100000},{year:"Y3",Team:2400000,AITools:120000,Hosting:80000,Operations:350000,Freelancers:400000},{year:"Y4",Team:4800000,AITools:200000,Hosting:150000,Operations:600000,Freelancers:750000},{year:"Y5",Team:7790000,AITools:300000,Hosting:250000,Operations:900000,Freelancers:1200000}];
const sensitivity=[{year:"Y1",bull:2698000,base:2287000,bear:1740000},{year:"Y2",bull:8139000,base:6900000,bear:5248000},{year:"Y3",bull:30329000,base:25684000,bear:19489000},{year:"Y4",bull:65030000,base:55040000,bear:41720000},{year:"Y5",bull:101311000,base:85733000,bear:64962000}];
const beData=[
  {yr:"Y1",revenue:2287000,costs:400000,ebitda:1887000,projects:5,beProjects:1},
  {yr:"Y2",revenue:6900000,costs:1090000,ebitda:5810000,projects:15,beProjects:2},
  {yr:"Y3",revenue:25684000,costs:3350000,ebitda:22334000,projects:50,beProjects:7},
  {yr:"Y4",revenue:55040000,costs:6500000,ebitda:48540000,projects:100,beProjects:12},
  {yr:"Y5",revenue:85733000,costs:10440000,ebitda:75293000,projects:150,beProjects:18},
];

const C={accent:'#8E3C3C',warm:'#B06868',coral:'#D0A0A0',navy:'#8E3C3C',plum:'#B06868',sand:'#D0A0A0',stone:'#88888E'};
const P=['#8E3C3C','#B06868','#D0A0A0','#8E3C3C99','#B0686899','#D0A0A099','#8E3C3C66'];
function fmt(n){if(n>=1e9)return(n/1e9).toFixed(2)+'B';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return(n/1e3).toFixed(0)+'K';return n.toString();}

// ===== TABS =====
const tabs=[
  {id:'exec',label:'Overview'},
  {id:'research',label:'Market Research'},
  {id:'model',label:'Business Model'},
  {id:'ai',label:'AI Tech Stack'},
  {id:'pricing',label:'Pricing'},
  {id:'villa',label:'Luxury Villas'},
  {id:'revenue',label:'5-Year Pipeline'},
  {id:'team',label:'Team / Costs'},
  {id:'market',label:'Markets / Roadmap'},
  {id:'scenarios',label:'Scenarios'}
];
let currentTab='exec';

function switchTab(id){
  currentTab=id;
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.tab===id));
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.toggle('active',t.id==='tab-'+id));
  // Re-render charts for the active tab
  setTimeout(()=>renderChartsForTab(id),100);
}

// ===== INIT =====
function initDashboard(){
  document.getElementById('headerRev').textContent = fmt(cumRev);
  document.getElementById('headerEbitda').textContent = fmt(cumEbitda);

  // Build tab bar
  const bar = document.getElementById('tabBar');
  bar.innerHTML = tabs.map(t=>`<button class="tab-btn ${t.id==='exec'?'active':''}" data-tab="${t.id}" onclick="switchTab('${t.id}')">${t.label}</button>`).join('');

  // Build content
  const area = document.getElementById('contentArea');
  area.innerHTML = tabs.map(t=>`<div class="tab-content ${t.id==='exec'?'active':''}" id="tab-${t.id}">${buildTab(t.id)}</div>`).join('');

  // Render initial charts
  setTimeout(()=>renderChartsForTab('exec'),200);
}

// ===== CHART REGISTRY =====
const chartInstances={};
function createChart(canvasId, config){
  if(chartInstances[canvasId]){chartInstances[canvasId].destroy();}
  const ctx=document.getElementById(canvasId);
  if(!ctx)return;
  chartInstances[canvasId]=new Chart(ctx,config);
}

const chartDefaults={
  responsive:true,maintainAspectRatio:false,
  plugins:{legend:{labels:{font:{family:'DM Sans',size:11},usePointStyle:true,padding:16}},tooltip:{backgroundColor:'#2C2C32',titleFont:{family:'DM Sans',size:12},bodyFont:{family:'DM Sans',size:11},padding:12,cornerRadius:8,callbacks:{label:function(c){return c.dataset.label+': '+fmt(c.parsed.y||c.parsed);}}}},
  scales:{x:{grid:{display:false},ticks:{font:{family:'DM Sans',size:11},color:'#88888E'}},y:{grid:{color:'#EBEBEE'},ticks:{font:{family:'DM Sans',size:11},color:'#88888E',callback:v=>fmt(v)}}}
};

function renderChartsForTab(tabId){
  switch(tabId){
    case 'exec': renderExecCharts(); break;
    case 'research': renderResearchCharts(); break;
    case 'model': renderModelCharts(); break;
    case 'revenue': renderRevenueCharts(); break;
    case 'team': renderTeamCharts(); break;
    case 'scenarios': renderScenarioCharts(); break;
  }
}

// ===== BUILD TABS =====
function buildTab(id){
  switch(id){
    case 'exec': return buildExec();
    case 'research': return buildResearch();
    case 'model': return buildModel();
    case 'ai': return buildAI();
    case 'pricing': return buildPricing();
    case 'villa': return buildVilla();
    case 'revenue': return buildRevenue();
    case 'team': return buildTeam();
    case 'market': return buildMarket();
    case 'scenarios': return buildScenarios();
    default: return '';
  }
}

// ===== HELPER BUILDERS =====
function kpi(title,value,sub,color){
  return `<div class="kpi"><div class="kpi-title">${title}</div><div class="kpi-value" style="color:${color||'var(--text)'}">${value}</div><div class="kpi-sub">${sub}</div></div>`;
}
function box(title,sub,content,style){
  return `<div class="box" style="${style||''}">${title?`<div class="box-title">${title}</div>`:''}${sub?`<div class="box-sub">${sub}</div>`:''}${content||''}</div>`;
}
function fiveYearTable(){
  let rows=fiveYear.map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold" style="color:var(--accent)">${d.year}</td><td class="right">${d.projects}</td><td class="right bold" style="color:var(--accent)">${fmt(d.revenue)}</td><td class="right" style="color:var(--coral)">${fmt(d.costs)}</td><td class="right bold">${fmt(d.ebitda)}</td><td class="right">${d.margin}%</td><td class="right">${d.team}</td></tr>`).join('');
  rows+=`<tr class="total"><td class="bold">CUMULATIVE</td><td class="right bold">320</td><td class="right bold" style="color:var(--accent)">${fmt(cumRev)}</td><td class="right bold" style="color:var(--coral)">${fmt(cumCosts)}</td><td class="right bold">${fmt(cumEbitda)}</td><td class="right bold">88%</td><td class="right">95</td></tr>`;
  return `<div style="overflow-x:auto"><table><thead><tr><th></th><th class="right">Projects</th><th class="right">Revenue</th><th class="right">Costs</th><th class="right">EBITDA</th><th class="right">Margin</th><th class="right">Team</th></tr></thead><tbody>${rows}</tbody></table></div>`;
}

// ========== TAB: OVERVIEW ==========

// ========== TAB: OVERVIEW (already comprehensive) ==========
function buildExec(){
  return `
  ${box('Executive Summary','Nexura - AI-Powered European Proptech Agency',`<p>Nexura is an AI-powered proptech agency replicating the proven Launchbase SA model for European markets. Combining content creation, performance marketing, and an interactive sales platform for off-plan developers, we use <strong>AI to reduce delivery costs 50-80%</strong>, enabling competitive pricing with industry-leading margins. Over 5 years, we project <strong>320 projects</strong> generating <strong>${fmt(cumRev)} in cumulative revenue</strong> with <strong>${fmt(cumEbitda)} EBITDA (88% margin)</strong>. The business is profitable from its very first project.</p>`)}
  <div class="kpi-grid">
    ${kpi('Year 5 Revenue',fmt(y5.revenue),y5.margin+'% margin',C.accent)}
    ${kpi('Year 5 EBITDA',fmt(y5.ebitda),'88% margin',C.warm)}
    ${kpi('Total Projects','320','5-year total',C.navy)}
    ${kpi('Peak Team','95',fmt(Math.round(y5.revenue/y5.team))+' rev/head',C.plum)}
    ${kpi('Implied Valuation','753M-1.13B','10-15x Y5 EBITDA',C.coral)}
    ${kpi('Breakeven','~1 project','Cash positive Month 3',C.sand)}
  </div>
  <div class="grid-2">
    ${box('Growth Trajectory','',`<div class="chart-container"><canvas id="execGrowthChart"></canvas></div>`)}
    ${box('Cumulative Revenue / EBITDA','',`<div class="chart-container"><canvas id="execCumChart"></canvas></div>`)}
  </div>
  ${box('5-Year Financial Summary','',fiveYearTable())}
  ${box('Market Opportunity','Key findings from Market Research tab',`
    <div class="grid-4" style="margin-bottom:16px">
      <div style="background:var(--accentSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;color:var(--textLight);font-weight:600">PREMIUM PROJECTS</div><div style="font-size:20px;font-weight:700;color:var(--accent)">~2,700/yr</div><div style="font-size:10px;color:var(--textMuted)">across 4 markets</div></div>
      <div style="background:var(--warmSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;color:var(--textLight);font-weight:600">PREMIUM UNITS</div><div style="font-size:20px;font-weight:700;color:var(--warm)">~116,000/yr</div><div style="font-size:10px;color:var(--textMuted)">Spain, UK, DE, SE</div></div>
      <div style="background:var(--navySoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;color:var(--textLight);font-weight:600">TAM (SERVICES)</div><div style="font-size:20px;font-weight:700;color:var(--navy)">~1.2B/yr</div><div style="font-size:10px;color:var(--textMuted)">at avg fee per project</div></div>
      <div style="background:var(--coralSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;color:var(--textLight);font-weight:600">Y5 SHARE NEEDED</div><div style="font-size:20px;font-weight:700;color:var(--coral)">5.6%</div><div style="font-size:10px;color:var(--textMuted)">150 of 2,700 projects</div></div>
    </div>
    <div class="grid-4">
      ${[{flag:'Spain',stat:'135K new-build sales',sub:'Primary target. Luxury +20% Marbella. 30%+ foreign buyers.',c:'coral'},{flag:'UK',stat:'180K completions',sub:'Deepest premium market. Luxury +13%. 32% off-plan rate.',c:'navy'},{flag:'Germany',stat:'215K permits',sub:'Supply crisis = opportunity. 9.84B investment volume.',c:'accent'},{flag:'Sweden',stat:'22K starts (Q1-3)',sub:'Recovery +8%. Highest digital adoption. New 2025 regs.',c:'plum'}].map(d=>`<div class="stat-card ${d.c}-top"><div style="font-size:13px;font-weight:700" class="c-${d.c}">${d.flag}</div><div style="font-size:15px;font-weight:700;margin:4px 0">${d.stat}</div><div style="font-size:11px;color:var(--textMuted)">${d.sub}</div></div>`).join('')}
    </div>
  `,'border-left:4px solid var(--accent)')}
  ${box('Business Model','Key findings from Business Model tab',`
    <p>Four revenue streams: <strong>Onboarding (15K-80K)</strong>, <strong>Pre-Launch (5K-15K)</strong>, <strong>Retainer (2.5K-6K/mo)</strong>, and <strong>Success Fees (1-2%)</strong>. Success fees dominate at 84-85%.</p>
    <div class="grid-4" style="margin:16px 0">
      ${[{phase:'Onboarding',rev:'6%',desc:'15K-80K one-time',c:'navy'},{phase:'Retainers',rev:'7%',desc:'2.5K-6K/mo',c:'accent'},{phase:'SaaS',rev:'2%',desc:'Platform licensing',c:'plum'},{phase:'Success Fees',rev:'85%',desc:'1-2% per unit sold',c:'coral'}].map(d=>`<div class="stat-card" style="text-align:center"><div style="font-size:28px;font-weight:700;color:var(--${d.c})">${d.rev}</div><div style="font-size:12px;font-weight:700;margin:4px 0">${d.phase}</div><div style="font-size:10px;color:var(--textMuted)">${d.desc}</div></div>`).join('')}
    </div>
    <div class="grid-2">
      <div>
        <div style="font-weight:700;font-size:13px;color:var(--warm);margin-bottom:6px">Client Lifetime Value</div>
        <table><thead><tr><th>Segment</th><th class="right">Units</th><th class="right">Avg Price</th><th class="right">Total CLV</th></tr></thead><tbody>
        ${[{s:'Small Dev',u:30,p:'€800K',clv:282000,c:'accent'},{s:'Medium Dev',u:90,p:'€750K',clv:720500,c:'warm'},{s:'Large Dev',u:200,p:'€500K',clv:1045000,c:'navy'},{s:'Luxury Villa',u:1,p:'€5M+',clv:139000,c:'coral'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold" style="color:var(--${d.c})">${d.s}</td><td class="right">${d.u}</td><td class="right">${d.p}</td><td class="right bold" style="color:var(--accent)">${fmt(d.clv)}</td></tr>`).join('')}
        </tbody></table>
      </div>
      <div>
        <div style="font-weight:700;font-size:13px;color:var(--warm);margin-bottom:6px">Competitive Advantages</div>
        <ul class="ul"><li>50-80% cheaper than traditional agencies</li><li>4-6 week delivery vs 3-6 months</li><li>Integrated sales platform (unique)</li><li>Success-fee alignment</li><li>Growing investor database moat</li><li>Multi-market from Day 1</li></ul>
      </div>
    </div>
  `,'border-left:4px solid var(--warm)')}
  ${box('AI Technology Advantage','Key findings from AI Tech Stack tab',`
    <p>AI replaces 50-80% of human labour. Traditional agencies need 3-5x more staff for the same output.</p>
    <div class="grid-4">
      ${[{area:'3D Renders',trad:'30K-50K',ours:'3K-10K',saving:'70-80%',c:'accent',tools:'Midjourney, Luma AI, ComfyUI'},{area:'Branding',trad:'12K-23K',ours:'1.5K-4K',saving:'80-85%',c:'warm',tools:'Looka, Figma AI, Claude/GPT-4'},{area:'Sales Platform',trad:'30K-80K',ours:'5K-15K',saving:'70-80%',c:'navy',tools:'Next.js, React, Stripe, HubSpot'},{area:'Marketing Ops',trad:'3-5K/mo',ours:'0.5-1K/mo',saving:'75-80%',c:'coral',tools:'Meta Advantage+, Brevo, Zapier'}].map(d=>`<div class="stat-card ${d.c}-top"><div style="font-size:13px;font-weight:700;margin-bottom:6px" class="c-${d.c}">${d.area}</div><div style="display:flex;justify-content:space-between;margin-bottom:2px"><span style="font-size:11px" class="c-muted">Traditional</span><span style="font-size:11px;color:var(--coral);text-decoration:line-through">${d.trad}</span></div><div style="display:flex;justify-content:space-between;margin-bottom:2px"><span style="font-size:11px" class="c-muted">Our Cost</span><span style="font-size:11px;font-weight:700" class="c-accent">${d.ours}</span></div><div style="display:flex;justify-content:space-between;margin-bottom:6px"><span style="font-size:11px" class="c-muted">Saving</span><span style="font-size:12px;font-weight:700" class="c-accent">${d.saving}</span></div><div style="font-size:10px" class="c-light">${d.tools}</div></div>`).join('')}
    </div>
  `,'border-left:4px solid var(--plum)')}
  ${box('Revenue Streams & Project Mix','Key data from 5-Year Pipeline tab',`
    <div class="grid-2"><div class="chart-container small"><canvas id="execStreamsChart"></canvas></div><div class="chart-container small"><canvas id="execMixChart"></canvas></div></div>
    <div class="grid-5">
      ${fiveYear.map((d,i)=>`<div class="stat-card ${['accent','warm','navy','coral','plum'][i]}-top"><div style="font-size:12px;font-weight:700" class="c-${['accent','warm','navy','coral','plum'][i]}">${d.year}</div><div style="font-size:11px" class="c-muted">${d.projects} projects</div><div style="font-size:15px;font-weight:700" class="c-accent">${fmt(d.revenue)}</div><div style="font-size:11px" class="c-muted">EBITDA: ${fmt(d.ebitda)}</div><div style="font-size:11px;font-weight:600" class="c-warm">${d.margin}% margin</div></div>`).join('')}
    </div>
  `,'border-left:4px solid var(--navy)')}
  ${box('Team Scaling / Breakeven','Key findings from Team / Costs tab',`
    <div class="grid-2" style="margin-bottom:16px">
      <div class="chart-container small"><canvas id="execTeamChart"></canvas></div>
      <div>
        <div class="grid-3" style="margin-bottom:12px">
          <div style="background:var(--accentSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;font-weight:600" class="c-light">Y1 BREAKEVEN</div><div style="font-size:20px;font-weight:700" class="c-accent">~1 project</div></div>
          <div style="background:var(--coralSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;font-weight:600" class="c-light">COST/REV RATIO</div><div style="font-size:20px;font-weight:700" class="c-coral">17% to 12%</div></div>
          <div style="background:var(--navySoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;font-weight:600" class="c-light">SAFETY MULTIPLE</div><div style="font-size:20px;font-weight:700" class="c-navy">5-8x</div></div>
        </div>
        <table><thead><tr><th>Year</th><th class="right">Team</th><th class="right">Cost</th><th class="right">Rev/Head</th></tr></thead><tbody>
        ${fiveYear.map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold" style="color:var(--${['accent','warm','navy','coral','plum'][i]})">${d.yr}</td><td class="right">${d.team}</td><td class="right">${fmt(d.costs)}</td><td class="right bold" style="color:var(--accent)">${fmt(Math.round(d.revenue/d.team))}</td></tr>`).join('')}
        </tbody></table>
      </div>
    </div>
    <p>Team scales from <strong>4 in Y1</strong> to <strong>95 by Y5</strong> across 7 departments. AI means each person handles 3-5x more output.</p>
  `,'border-left:4px solid var(--navy)')}
  ${box('Scenario Analysis / Valuation','Key findings from Scenarios tab',`
    <div class="grid-2" style="margin-bottom:16px">
      <div class="chart-container small"><canvas id="execSensChart"></canvas></div>
      <div>
        <div class="grid-3" style="margin-bottom:12px">
          ${[{l:'Bull (Y5)',v:fmt(101311000),s:'85% sell-through',c:'accent'},{l:'Base (Y5)',v:fmt(85733000),s:'70% sell-through',c:'warm'},{l:'Bear (Y5)',v:fmt(64962000),s:'50% sell-through',c:'coral'}].map(d=>`<div class="stat-card" style="text-align:center"><div style="font-size:10px;font-weight:600" class="c-muted">${d.l}</div><div style="font-size:18px;font-weight:700" class="c-${d.c}">${d.v}</div><div style="font-size:10px" class="c-light">${d.s}</div></div>`).join('')}
        </div>
        <div class="grid-3">
          ${[{l:'Conservative',m:'6x EBITDA',v:'€134M',c:C.coral},{l:'Mid-Range',m:'10x EBITDA',v:'€753M',c:C.warm},{l:'Premium',m:'15x EBITDA',v:'€1.13B',c:C.accent}].map(d=>`<div class="val-card" style="background:${d.c}"><div class="label">${d.l}</div><div class="value">${d.v}</div><div class="mult">${d.m}</div></div>`).join('')}
        </div>
      </div>
    </div>
    <p>Comparable proptech businesses trade at 8-15x EBITDA → <strong>€753M-1.13B enterprise value</strong> at Y5. Bear case still generates €65M Y5 revenue.</p>
  `,'border-left:4px solid var(--coral)')}
  ${box('Why This Works','',`
    <div class="grid-3">
      <div class="pillar bg-accent"><div class="pillar-num c-accent">1</div><div class="pillar-title">Proven Model</div><p>Launchbase SA moved R10.2B (€588M+) across 45+ developments. Nexura adapts this for Europe with AI.</p></div>
      <div class="pillar bg-warm"><div class="pillar-num c-warm">2</div><div class="pillar-title">AI Cost Revolution</div><p>Costs cut 50-80%. Renders in 3-5 days not 6 weeks. 50-80% cheaper at 85%+ margins.</p></div>
      <div class="pillar bg-coral"><div class="pillar-num c-coral">3</div><div class="pillar-title">Premium Unit Values</div><p>Units at €500K-800K = €5K-16K per sale in success fees. Near-zero marginal cost.</p></div>
    </div>
  `)}`;
}

// ========== TAB: MARKET RESEARCH (already good) ==========
function buildResearch(){
  return `
  ${box('Premium Development Market Research','Data from national statistics offices, CaixaBank Research, Savills, JLL, Fine and Country, Statistics Sweden, Destatis (2024-2025)',`<p>We researched new-build residential development volumes across four initial target markets. We estimate <strong>~2,700 premium projects per year</strong> representing over <strong>116,000 premium units</strong> annually.</p>`)}
  <div class="kpi-grid">
    ${kpi('Premium Projects','~2,700/yr','Addressable market',C.accent)}
    ${kpi('Premium Units','~116,000/yr','Spain, UK, DE, SE',C.warm)}
    ${kpi('TAM (Services)','~€1.2B/yr','At avg fee per project',C.navy)}
    ${kpi('Y5 Share Needed','~5.6%','150 of 2,700 projects',C.coral)}
  </div>
  <div class="grid-2">
    ${box('Spain - The Primary Target','',`<p>Spain recorded <strong>135,052 new-build transactions</strong> in 2024 (+23.4%, highest since 2013). Total sales 716,183 units. Housing starts +14.5% to 112,220.</p><p>Marbella/Estepona luxury grew <strong>20% in 2024</strong>, investments exceeding €3.2B. 30%+ foreign buyers in Malaga. Sell-outs in 30-45 days. Est. <strong>800-1,500 premium projects</strong>, <strong>40K-55K premium units</strong>/yr.</p><div class="grid-3" style="margin-top:12px">${[['New-Build Sales','135,052'],['Luxury Growth','+20%'],['Foreign Buyers','30%+'],['Premium Projects','800-1,500'],['Premium Units','40K-55K'],['Key Areas','Costa del Sol, Balearics']].map(s=>`<div style="background:var(--coralSoft);border-radius:6px;padding:8px 12px"><div style="font-size:10px;font-weight:600" class="c-light">${s[0]}</div><div style="font-size:14px;font-weight:700" class="c-coral">${s[1]}</div></div>`).join('')}</div>`,'border-left:4px solid var(--coral)')}
    ${box('United Kingdom - Premium Volume','',`<p>UK completed ~<strong>180,700 new homes</strong> 2024/25. Premium segment resilient: high-end +13% over 5 years vs average -5%.</p><p>32% off-plan. Super-prime 75% cash. Luxury <strong>5.2% CAGR through 2031</strong>. Est. <strong>500-1,000 premium projects</strong>, <strong>27K-45K units</strong>/yr.</p><div class="grid-3" style="margin-top:12px">${[['Completions','~180,700'],['Luxury CAGR','+5.2%'],['Off-Plan Sales','32%'],['Premium Projects','500-1,000'],['Premium Units','27K-45K'],['Key Areas','London, Manchester']].map(s=>`<div style="background:var(--navySoft);border-radius:6px;padding:8px 12px"><div style="font-size:10px;font-weight:600" class="c-light">${s[0]}</div><div style="font-size:14px;font-weight:700" class="c-navy">${s[1]}</div></div>`).join('')}</div>`,'border-left:4px solid var(--navy)')}
    ${box('Germany - Supply Crisis = Opportunity','',`<p>Permits dropped 17% to <strong>215,900</strong> — 14-year low. Target 400K/yr far off. Completions to fall to 175K by 2025-26.</p><p>Residential investment: <strong>€9.84B in 2024</strong>. Berlin €2.35B Q1 2025 (3x YoY). Est. <strong>400-800 premium projects</strong>, <strong>20K-35K units</strong>/yr.</p><div class="grid-3" style="margin-top:12px">${[['Building Permits','215,900'],['YoY Change','-17%'],['Invest. Volume','€9.84B'],['Premium Projects','400-800'],['Premium Units','20K-35K'],['Key Areas','Berlin, Munich, HH']].map(s=>`<div style="background:var(--accentSoft);border-radius:6px;padding:8px 12px"><div style="font-size:10px;font-weight:600" class="c-light">${s[0]}</div><div style="font-size:14px;font-weight:700" class="c-accent">${s[1]}</div></div>`).join('')}</div>`,'border-left:4px solid var(--accent)')}
    ${box('Sweden - Recovery Phase','',`<p><strong>22,200 dwellings started</strong> Q1-3 2025 (+8%). New 2025 regs most extensive in 15 years.</p><p>High digital adoption ideal for platform-first. Est. <strong>100-300 premium projects</strong>, <strong>4.5K-6K units</strong>/yr.</p><div class="grid-3" style="margin-top:12px">${[['Dwellings Started','~30K/yr'],['YoY Change','+8%'],['Rental Share','71%'],['Premium Projects','100-300'],['Premium Units','4.5K-6K'],['Key Areas','Stockholm, Gothenburg']].map(s=>`<div style="background:var(--plumSoft);border-radius:6px;padding:8px 12px"><div style="font-size:10px;font-weight:600" class="c-light">${s[0]}</div><div style="font-size:14px;font-weight:700" class="c-plum">${s[1]}</div></div>`).join('')}</div>`,'border-left:4px solid var(--plum)')}
  </div>
  <div class="grid-2">
    ${box('New-Build Activity by Country','',`<div class="chart-container"><canvas id="researchBarChart"></canvas></div>`)}
    ${box('Premium Projects Distribution','',`<div class="chart-container"><canvas id="researchPieChart"></canvas></div>`)}
  </div>
  ${box('TAM by Market','',`<table><thead><tr><th>Market</th><th class="right">Est. Projects/yr</th><th class="right">TAM (Services)</th><th class="right">Our Y1</th><th class="right">Our Y5</th></tr></thead><tbody>
    ${[{c:'Spain',p:1150,t:518000000,cc:'coral'},{c:'UK',p:750,t:375000000,cc:'navy'},{c:'Germany',p:600,t:228000000,cc:'accent'},{c:'Sweden',p:200,t:70000000,cc:'plum'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold" style="color:var(--${d.cc})">${d.c}</td><td class="right">${d.p.toLocaleString()}</td><td class="right bold">${fmt(d.t)}</td><td class="right">3-5</td><td class="right">40-60</td></tr>`).join('')}
    <tr class="total"><td class="bold">TOTAL</td><td class="right bold">2,700</td><td class="right bold c-accent">~€1.2B</td><td class="right bold">5</td><td class="right bold">150</td></tr>
  </tbody></table>`)}
  ${box('Market Penetration Analysis','',`
    <div class="grid-5">
      ${[{yr:'Y1',proj:5,pct:'0.2%',c:'accent'},{yr:'Y2',proj:15,pct:'0.6%',c:'warm'},{yr:'Y3',proj:50,pct:'1.9%',c:'navy'},{yr:'Y4',proj:100,pct:'3.7%',c:'coral'},{yr:'Y5',proj:150,pct:'5.6%',c:'plum'}].map(d=>`<div class="stat-card ${d.c}-top" style="text-align:center"><div style="font-size:12px;font-weight:600" class="c-muted">${d.yr}</div><div style="font-size:28px;font-weight:700" class="c-${d.c}">${d.pct}</div><div style="font-size:12px" class="c-muted">${d.proj} of 2,700</div></div>`).join('')}
    </div>
    <p>Even at Y5, only 5.6% market share across 4 countries. Very achievable given most developers use fragmented traditional agencies.</p>
  `)}
  ${box('Key Strategic Takeaways','',`<div class="grid-2">${[{t:'Spain: Start Here',c:'coral',p:'Massive off-plan volume (135K sales), 30%+ foreign buyers, luxury +20%. Sell-outs in 30-45 days.'},{t:'UK: Premium Volume',c:'navy',p:'Deepest premium market. Luxury counter-cyclical: +13%. 32% off-plan confirms model fit.'},{t:'Germany: Pricing Power',c:'accent',p:'Construction crisis means every unit matters. Perfect for platform-first marketing.'},{t:'Sweden: Digital-First',c:'plum',p:'Premium-heavy, high digital adoption. New 2025 regs create tailwinds.'}].map(n=>`<div><div style="font-weight:700;font-size:14px;margin-bottom:6px" class="c-${n.c}">${n.t}</div><p>${n.p}</p></div>`).join('')}</div>`)}`;
}

// ========== TAB: BUSINESS MODEL (EXPANDED) ==========
function buildModel(){
  return `
  ${box('Business Model Overview','How Nexura adapts the Launchbase SA model for Europe with AI',`
    <p>The model combines <strong>agency fees</strong> (predictable onboarding), <strong>SaaS economics</strong> (recurring platform income), and <strong>performance commissions</strong> (success fees). Revenue grows faster than headcount because success fees have near-zero marginal cost.</p>
    <p>Launchbase SA has moved <strong>R10.2B (~€588M) in property sales</strong> across 45+ developments. Nexura improves on this with AI to cut delivery costs 50-80%.</p>
  `)}
  <div class="kpi-grid">
    ${kpi('Avg Revenue / Project','€139K-1.05M','Depends on segment',C.accent)}
    ${kpi('Client Lifetime','10-30 months','Onboarding to final sale',C.warm)}
    ${kpi('Success Fee Share','84-85%','Of total revenue',C.coral)}
    ${kpi('AI Cost Advantage','50-80%','Lower delivery cost',C.navy)}
    ${kpi('Proven Track Record','€588M+','Property sales by Launchbase SA',C.plum)}
  </div>

  ${box('The Client Journey','From first contact to final sale',`
    ${[{step:'1',title:'Discovery Call',dur:'Week 1',desc:'Developer contacts us. We assess project: location, unit count, price points, target market, timeline. Present approach and case studies.',c:C.accent},
    {step:'2',title:'Proposal / Sign',dur:'Week 2',desc:'Custom proposal with package tier, pricing, timeline. Success fee structure agreed. Contract signed, onboarding fee invoiced.',c:C.warm},
    {step:'3',title:'Onboarding Sprint',dur:'Week 3-6',desc:'AI renders (3-5 day turnaround vs 4-6 weeks traditional). Brand identity, website, sales platform configured. Brochure and ad creative produced.',c:C.navy},
    {step:'4',title:'Pre-Launch',dur:'Week 7-8',desc:'One-month intensive: paid ads across Meta/Google, email sequences, social content, PR outreach, investor database contacted.',c:C.coral},
    {step:'5',title:'Launch Day',dur:'Week 9',desc:'Platform live with full inventory. Live availability board, online reservations, deposit collection. 2% success fee on launch sales.',c:C.plum},
    {step:'6',title:'Ongoing Marketing',dur:'Month 3-12+',desc:'Monthly retainer. Ad optimisation, social media, email nurture, platform updates. 1% ongoing success fee. Monthly reporting.',c:C.sand}
    ].map(s=>`<div class="timeline-item"><div class="timeline-num" style="background:${s.c}">${s.step}</div><div class="timeline-content"><div class="timeline-title">${s.title} <span class="timeline-tag">${s.dur}</span></div><p style="margin:4px 0 0;font-size:12px">${s.desc}</p></div></div>`).join('')}
  `)}

  ${box('The Four Revenue Phases','Each client generates income through four mechanisms','')}
  <div class="grid-2">
    ${box('Phase 1: Onboarding Package (One-Time)','',`
      <div style="background:var(--accentSoft);border-radius:8px;padding:10px 14px;margin-bottom:12px;display:flex;justify-content:space-between"><span style="font-size:13px;font-weight:600" class="c-accent">European Price</span><span style="font-size:18px;font-weight:700" class="c-accent">€15K-80K</span></div>
      <p>Everything to go to market: 3D renders (10-25 images, 3-5 day AI turnaround), brand identity, marketing website, interactive sales platform, brochure, copywriting in 1-3 languages. Traditional agencies charge €80K-250K+.</p>
      <p>Launchbase SA price: R1,127,500 (~€56K). Nexura's pricing: €15K-80K — <strong>significantly cheaper than traditional agencies</strong> because AI handles 50-80% of production.</p>
    `,'border-left:4px solid var(--accent)')}
    ${box('Phase 2: Pre-Launch Campaign (One-Time)','',`
      <div style="background:var(--warmSoft);border-radius:8px;padding:10px 14px;margin-bottom:12px;display:flex;justify-content:space-between"><span style="font-size:13px;font-weight:600" class="c-warm">European Price</span><span style="font-size:18px;font-weight:700" class="c-warm">€5K-15K</span></div>
      <p>One-month intensive: paid ads (Meta/Google), social media launch, email/WhatsApp campaigns, PR outreach, lead capture. Goal: 200-500+ qualified leads before launch day.</p>
    `,'border-left:4px solid var(--warm)')}
    ${box('Phase 3: Monthly Retainer (Recurring)','',`
      <div style="background:var(--navySoft);border-radius:8px;padding:10px 14px;margin-bottom:12px;display:flex;justify-content:space-between"><span style="font-size:13px;font-weight:600" class="c-navy">European Price</span><span style="font-size:18px;font-weight:700" class="c-navy">€2.5K-6K/mo</span></div>
      <p>Ongoing: performance ad optimisation, social media, platform updates, email marketing, monthly reporting. Runs 10-24 months. Predictable recurring revenue.</p>
    `,'border-left:4px solid var(--navy)')}
    ${box('Phase 4: Success Fees (Performance)','',`
      <div style="background:var(--coralSoft);border-radius:8px;padding:10px 14px;margin-bottom:12px;display:flex;justify-content:space-between"><span style="font-size:13px;font-weight:600" class="c-coral">Fee Structure</span><span style="font-size:18px;font-weight:700" class="c-coral">1-2% of sales</span></div>
      <p>2% launch month, 1-1.5% ongoing. With €750K avg units: 90-unit dev at 70% sell-through = 63 units = €47.25M sales. <strong>Total success fees: €622.5K</strong> from one project.</p>
      <p>Represents <strong>84-85% of all revenue</strong>. Near-zero marginal cost — every euro of success fee is pure profit.</p>
    `,'border-left:4px solid var(--coral)')}
  </div>

  <div class="grid-2">
    ${box('Revenue Stream Composition','',`<div class="chart-container"><canvas id="modelStreamsChart"></canvas></div>`)}
    ${box('Single Client 4-Year Scenario','Large developer relationship',`
      <table><thead><tr><th>Year</th><th>Activity</th><th class="right">Revenue</th></tr></thead><tbody>
      ${[{y:'Year 1',a:'Phase 1 (80 units at €500K)',r:'€452K'},{y:'Year 2',a:'Phase 1 ongoing + Phase 2 (120 units at €550K)',r:'€882K'},{y:'Year 3',a:'Phase 2 ongoing + Phase 3 (150 units at €600K)',r:'€1,135K'},{y:'Year 4',a:'Phase 3 ongoing + 10 villas at €5M',r:'€1,580K'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold">${d.y}</td><td>${d.a}</td><td class="right bold c-accent">${d.r}</td></tr>`).join('')}
      <tr class="total"><td class="bold">4-YEAR TOTAL</td><td></td><td class="right bold c-accent">€4,049K</td></tr>
      </tbody></table>
    `)}
  </div>

  ${box('Client Lifetime Value by Segment','Total revenue from a single project across all four phases',`
    <table><thead><tr><th>Segment</th><th class="right">Units</th><th class="right">Avg Price</th><th class="right">Onboard</th><th class="right">SaaS</th><th class="right">Retainer</th><th class="right">Media</th><th class="right">Success Fee</th><th class="right">Total CLV</th><th class="right">Margin</th></tr></thead><tbody>
    ${[{s:'Small Dev',u:30,p:'€800K',ob:'€20K',sa:'€10K',re:'€25K',me:'€3K',sf:'€224K',t:'€282K',m:'91%',c:'accent'},{s:'Medium Dev',u:90,p:'€750K',ob:'€40K',sa:'€10K',re:'€42K',me:'€6K',sf:'€622.5K',t:'€720.5K',m:'95%',c:'warm'},{s:'Large Dev',u:200,p:'€500K',ob:'€65K',sa:'€10K',re:'€60K',me:'€10K',sf:'€900K',t:'€1,045K',m:'96%',c:'navy'},{s:'Luxury Villa',u:1,p:'€5M+',ob:'€15K',sa:'€3K',re:'€18K',me:'€3K',sf:'€100K',t:'€139K',m:'89%',c:'coral'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold" style="color:var(--${d.c})">${d.s}</td><td class="right">${d.u}</td><td class="right">${d.p}</td><td class="right">${d.ob}</td><td class="right">${d.sa}</td><td class="right">${d.re}</td><td class="right">${d.me}</td><td class="right bold c-coral">${d.sf}</td><td class="right bold c-accent">${d.t}</td><td class="right bold c-accent">${d.m}</td></tr>`).join('')}
    </tbody></table>
  `)}

  ${box('AI Cost Advantage: Traditional vs Nexura','',`
    <table><thead><tr><th>Deliverable</th><th class="right">Traditional</th><th class="right">AI-Powered</th><th class="right">Saving</th></tr></thead><tbody>
    ${[{item:'3D Renders (15-25)',trad:'€30K-50K',ai:'€3K-10K',s:'70-80%'},{item:'Animations',trad:'€15K-25K',ai:'€2K-5K',s:'75-85%'},{item:'Branding',trad:'€8K-15K',ai:'€1K-3K',s:'80-85%'},{item:'Website',trad:'€10K-25K',ai:'€2K-5K',s:'75-80%'},{item:'Sales Platform',trad:'€30K-80K',ai:'€5K-15K',s:'70-80%'},{item:'Copywriting',trad:'€4K-8K',ai:'€0.5K-1K',s:'85-90%'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold">${d.item}</td><td class="right c-coral">${d.trad}</td><td class="right bold c-accent">${d.ai}</td><td class="right bold c-accent">${d.s}</td></tr>`).join('')}
    <tr class="total"><td class="bold">Total Package</td><td class="right bold c-coral">€108K-224K</td><td class="right bold c-accent">€15.5K-43K</td><td class="right bold c-accent">70-80%</td></tr>
    </tbody></table>
  `)}

  ${box('How Nexura Differs from Launchbase SA','Key adaptations for the European market',`
    <div class="grid-3">
      ${[{t:'AI-First Production',c:'accent',d:'Launchbase uses traditional render studios. Nexura uses AI for 70-80% of creative production, cutting delivery from 6 weeks to 5 days and costs by 60-80%.'},{t:'Multi-Market Platform',c:'warm',d:'Built for European complexity: multi-currency, multi-language, GDPR-compliant, country-specific frameworks. Launchbase operates only in South Africa.'},{t:'Success Fee Focus',c:'coral',d:'Nexura leans harder into performance pricing. Lower onboarding fees compensated by success fees — lowers barrier to sign.'},{t:'Investor Database',c:'navy',d:'Proprietary database of international investors across all projects. This moat grows: no competitor can replicate 10,000+ qualified buyers.'},{t:'Platform as Product',c:'plum',d:'Interactive sales platform is IP that could be white-labelled or licensed. Launchbase uses third-party tools; Nexura builds its own.'},{t:'Speed to Market',c:'sand',d:'Contract to launch: 4-6 weeks vs 3-6 months at traditional agencies. Developers want to start selling immediately.'}].map(d=>`<div class="stat-card" style="border-left:3px solid var(--${d.c})"><div style="font-weight:700;font-size:13px;margin-bottom:4px" class="c-${d.c}">${d.t}</div><p style="font-size:12px;margin:0">${d.d}</p></div>`).join('')}
    </div>
  `)}

  ${box('Competitive Landscape','How we position against alternatives',`
    <table><thead><tr><th>Competitor Type</th><th>Examples</th><th>Strength</th><th>Weakness</th><th>Our Advantage</th></tr></thead><tbody>
    ${[{type:'Traditional Agencies',ex:'Savills New Homes, Knight Frank',str:'Brand, relationships',weak:'Expensive (€80-250K+), slow',adv:'50-80% cheaper, 4-6 week delivery'},{type:'Digital Agencies',ex:'General marketing firms',str:'Digital expertise',weak:'No property knowledge, no platform',adv:'Specialist + integrated platform'},{type:'In-House Teams',ex:'Developer marketing teams',str:'Direct control',weak:'High fixed costs, limited tech',adv:'AI tools + platform they cannot build'},{type:'Platform-Only',ex:'Rightmove, Idealista',str:'Audience reach',weak:'No marketing, no content',adv:'Full-service + performance fees'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold">${d.type}</td><td style="font-size:12px">${d.ex}</td><td style="font-size:12px">${d.str}</td><td style="font-size:12px" class="c-coral">${d.weak}</td><td style="font-size:12px" class="bold c-accent">${d.adv}</td></tr>`).join('')}
    </tbody></table>
  `)}

  ${box('Client Acquisition Strategy','How we find and sign developers',`
    <div class="grid-3">
      ${[{t:'Direct Outreach',c:'accent',items:['Research new developments via planning portals','LinkedIn outreach to development directors','Attend MIPIM, Expo Real, local property events','Cold email with case study attachments']},{t:'Referral / Network',c:'warm',items:['Developer-to-developer referrals (our #1 source)','Architecture firm partnerships','Legal/tax advisor introductions','Real estate agent network']},{t:'Inbound / Content',c:'navy',items:['SEO for "off-plan marketing [city]"','LinkedIn thought leadership content','Case study videos and results','Platform demo on website']}].map(s=>`<div class="stat-card ${s.c}-top"><div style="font-weight:700;font-size:13px;margin-bottom:8px" class="c-${s.c}">${s.t}</div><ul class="ul">${s.items.map(i=>`<li>${i}</li>`).join('')}</ul></div>`).join('')}
    </div>
  `)}

  ${box('Retention, Upsell & Cross-Sell','Growing revenue within existing clients',`
    <div class="grid-2">
      ${[{t:'Retention Strategies',c:'accent',items:['Dedicated AM per client (single point of contact)','Monthly performance dashboards','Quarterly business reviews with developer leadership','Priority access to new platform features','Flexible retainer terms based on sales velocity']},{t:'Upsell / Cross-Sell',c:'warm',items:['Phase 2/3/4 of same development','Additional developments by same group','Villa marketing for luxury-focused developers','White-label platform licensing','International buyer outreach packages','PR and media packages']}].map(s=>`<div><div style="font-weight:700;font-size:13px;margin-bottom:8px" class="c-${s.c}">${s.t}</div><ul class="ul">${s.items.map(i=>`<li>${i}</li>`).join('')}</ul></div>`).join('')}
    </div>
  `)}`;
}

// ========== TAB: AI TECH STACK (EXPANDED) ==========
function buildAI(){
  return `
  ${box('AI Technology Stack','How AI replaces 50-80% of human labour in each service area',`<p>Every layer of the service delivery uses AI to reduce costs and speed up turnaround. The result: we can offer €15K-80K packages that would cost €80K-250K+ at a traditional agency, while maintaining 85%+ gross margins.</p>`)}
  ${[{t:'3D Renders & Visualisation',c:'accent',d:'Cost drops from €36K to €3-10K per project (60-80% reduction). AI generates photorealistic renders in 3-5 days vs 4-6 weeks for traditional CGI studios.',items:['Midjourney V7 / Stable Diffusion XL for architectural concepts','Luma AI / Meshy for 3D model generation','ComfyUI for consistent style across render sets','Magnific AI for upscaling to print-ready resolution','Runway ML / Kling for walkthrough animations','Human QA artist refines every output — indistinguishable from traditional CGI']},{t:'Branding / Content Creation',c:'warm',d:'Full creative suite automated. 50-65% cost reduction. Brand identity, copywriting, brochures, social media content all AI-assisted.',items:['Looka / Brandmark + Figma AI for brand identity systems','Framer / Webflow for rapid website development','Claude / GPT-4 for multilingual copywriting (1-3 languages)','Canva AI / Adobe Firefly for social media design','AI-generated brochure layouts refined by human designer','All copy reviewed by native speaker for each market']},{t:'Interactive Sales Platform',c:'navy',d:'The tech moat. MVP: €5-10K. Full platform: €15-30K. No competitor offers this.',items:['Next.js / React frontend (fast, SEO-friendly)','Node.js / FastAPI + PostgreSQL backend','WebSockets for real-time inventory updates','Stripe integration for deposit collection','HubSpot CRM for lead management','Multi-currency, multi-language from Day 1','Investor portal with NDA-gated access']},{t:'Performance Marketing',c:'coral',d:'70-80% of execution automated by AI. Campaign setup, optimisation, and reporting all streamlined.',items:['Meta Advantage+ / Google Performance Max for automated campaigns','AdCreative.ai for generating 50+ ad variations per project','Brevo / ActiveCampaign for email automation sequences','Zapier / Make.com for workflow automation','AI-powered audience targeting and lookalike generation','Automated monthly reporting dashboards']}].map(s=>`
  ${box(s.t,'',`<p>${s.d}</p><ul class="ul">${s.items.map(i=>`<li>${i}</li>`).join('')}</ul>`,'border-left:4px solid var(--'+s.c+')')}`).join('')}
  ${box('AI vs Human: The Quality Question','',`<div class="grid-3"><div style="background:var(--accentSoft);border-radius:10px;padding:16px"><div style="font-weight:700;font-size:14px;margin-bottom:6px" class="c-accent">AI Handles (80%)</div><p>Initial concepts, variations, bulk production, copywriting drafts, ad creative, email sequences, social media templates, basic animations, upscaling.</p></div><div style="background:var(--warmSoft);border-radius:10px;padding:16px"><div style="font-weight:700;font-size:14px;margin-bottom:6px" class="c-warm">Human Refines (20%)</div><p>Quality assurance, brand consistency checks, complex architectural details, client presentations, strategy, native language review, final approvals.</p></div><div style="background:var(--navySoft);border-radius:10px;padding:16px"><div style="font-weight:700;font-size:14px;margin-bottom:6px" class="c-navy">Result</div><p>Indistinguishable from traditional agency output in blind tests. 2 revision rounds included. Delivered in days not weeks. Every project has human eyes before delivery.</p></div></div>`)}`;
}

// ========== TAB: PRICING (EXPANDED) ==========
function buildPricing(){
  return `
  ${box('European Pricing Strategy','Three tiers + luxury villa, competitive against traditional agencies charging €50K-150K+','')}
  <div class="grid-3">
    ${[{tier:'Starter',price:'€15K-25K',ret:'€2,500/mo',fee:'1.5%',c:C.accent,tgt:'Small (10-50 units)',items:['AI renders (10+5 animations)','Basic branding & identity','Framer template website','Platform setup (basic)','Pre-launch campaign','Monthly performance reporting']},{tier:'Professional',price:'€25K-45K',ret:'€4,000/mo',fee:'1.5%/2%',c:C.warm,tgt:'Medium (50-200 units)',items:['Full renders + virtual tour','Complete branding suite','Custom-designed website','Full platform + CRM integration','Advanced pre-launch (2-week)','Dedicated account manager','Monthly + quarterly reviews']},{tier:'Enterprise',price:'€45K-80K+',ret:'€6,000+/mo',fee:'1%/2%',c:C.navy,tgt:'Large (200+ / premium)',items:['Premium renders + human refinement','Video production (drone/walkthrough)','International multi-market campaigns','Full investor database access','White-glove account management','Weekly reporting + strategy calls','Multi-language (3+ markets)']}].map(t=>`<div style="background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden"><div style="background:${t.c};padding:16px 22px;color:#fff"><div style="font-size:11px;font-weight:600;opacity:0.8;text-transform:uppercase">${t.tier}</div><div style="font-size:22px;font-weight:700;margin-top:4px">${t.price}</div></div><div style="padding:22px"><div style="font-size:12px;color:var(--textMuted);margin-bottom:12px">${t.tgt}</div>${t.items.map(i=>`<div style="font-size:12px;color:var(--textMed);padding:5px 0;border-bottom:1px solid var(--borderLight)">${i}</div>`).join('')}<div style="margin-top:14px;display:flex;gap:12px"><div style="background:var(--cardAlt);border-radius:6px;padding:6px 10px;font-size:11px">Retainer: <strong>${t.ret}</strong></div><div style="background:var(--cardAlt);border-radius:6px;padding:6px 10px;font-size:11px">Success: <strong>${t.fee}</strong></div></div></div></div>`).join('')}
  </div>
  ${box('Per-Project Revenue Model','',`<table><thead><tr><th>Segment</th><th class="right">Units</th><th class="right">Avg Price</th><th class="right">Onboarding</th><th class="right">Success Fee</th><th class="right">Total</th><th class="right">Margin</th></tr></thead><tbody>
  ${[{s:'Small Dev',u:30,p:'€800K',ob:'€20K',sf:'€224K',t:'€282K',m:'91%'},{s:'Medium Dev',u:90,p:'€750K',ob:'€40K',sf:'€622.5K',t:'€720.5K',m:'95%'},{s:'Large Dev',u:200,p:'€500K',ob:'€65K',sf:'€900K',t:'€1,045K',m:'96%'},{s:'Luxury Villa',u:1,p:'€5M+',ob:'€15K',sf:'€100K',t:'€139K',m:'89%'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold c-accent">${d.s}</td><td class="right">${d.u}</td><td class="right">${d.p}</td><td class="right">${d.ob}</td><td class="right bold c-coral">${d.sf}</td><td class="right bold c-accent">${d.t}</td><td class="right bold c-accent">${d.m}</td></tr>`).join('')}
  </tbody></table>`)}
  ${box('Success Fee Calculation Example','90-unit development at €750K average',`
    <div class="grid-4">
      <div style="background:var(--accentSoft);border-radius:8px;padding:12px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">TOTAL UNITS</div><div style="font-size:22px;font-weight:700" class="c-accent">90</div></div>
      <div style="background:var(--warmSoft);border-radius:8px;padding:12px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">70% SOLD</div><div style="font-size:22px;font-weight:700" class="c-warm">63 units</div></div>
      <div style="background:var(--navySoft);border-radius:8px;padding:12px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">TOTAL SALES</div><div style="font-size:22px;font-weight:700" class="c-navy">€47.25M</div></div>
      <div style="background:var(--coralSoft);border-radius:8px;padding:12px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">TOTAL SF</div><div style="font-size:22px;font-weight:700" class="c-coral">€622.5K</div></div>
    </div>
    <p style="margin-top:12px">Launch: 20 units × €750K × 2% = <strong>€300K</strong>. Ongoing: 43 units × €750K × 1% = <strong>€322.5K</strong>.</p>
  `)}`;
}

// ========== TAB: LUXURY VILLAS (EXPANDED) ==========
function buildVilla(){
  return `
  ${box('Luxury Villa Package (€5M+)','Marketing UHNWI properties through exclusivity and storytelling','')}
  <div class="kpi-grid">
    ${kpi('Revenue per Villa','€139K','Single €5M villa',C.coral)}
    ${kpi('Gross Margin','85-90%','AI-powered delivery',C.accent)}
    ${kpi('Y5 Villa Revenue',fmt(3475000),'25 villas',C.plum)}
    ${kpi('Sales Cycle','6 months','Shorter than developments',C.warm)}
  </div>
  <div class="grid-3">
    ${[{t:'Content / Visualisation',cost:'€15K-25K',c:'accent',items:['15-25 premium AI renders','Virtual tour (2-3 min)','Interactive 3D model','Printed luxury lookbook','Drone footage coordination']},{t:'Branding / Digital',cost:'€8K-15K',c:'warm',items:['Unique property brand','Dedicated website with NDA-gated plans','SEO landing pages','Password-protected brochure','Social media content pack']},{t:'Marketing / Leads',cost:'€12K-25K',c:'coral',items:['UHNWI programmatic ads','LinkedIn/Meta wealth targeting','Curated email campaigns','Private launch events','International buyer outreach']}].map(s=>`<div style="background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden"><div style="background:var(--${s.c});padding:14px 20px;color:#fff"><div style="font-size:15px;font-weight:700">${s.t}</div><div style="font-size:13px;opacity:0.85">${s.cost}</div></div><div style="padding:18px">${s.items.map(i=>`<div style="font-size:12px;color:var(--textMed);padding:5px 0;border-bottom:1px solid var(--borderLight)">${i}</div>`).join('')}</div></div>`).join('')}
  </div>
  ${box('Success Fee Tiers by Property Value','',`<table><thead><tr><th>Property Value</th><th class="right">Fee %</th><th class="right">Fee Amount</th><th class="right">Retainer</th></tr></thead><tbody>
  ${[{r:'€5M-7.5M',f:'2.0%',a:'€100K-150K',ret:'€3,000/mo'},{r:'€7.5M-10M',f:'1.75%',a:'€131K-175K',ret:'€4,000/mo'},{r:'€10M-15M',f:'1.5%',a:'€150K-225K',ret:'€5,000/mo'},{r:'€15M-25M',f:'1.25%',a:'€187.5K-312.5K',ret:'€7,500/mo'},{r:'€25M+',f:'1.0%',a:'€250K+',ret:'€10,000/mo'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold">${d.r}</td><td class="right bold c-coral">${d.f}</td><td class="right">${d.a}</td><td class="right">${d.ret}</td></tr>`).join('')}
  </tbody></table>`)}
  ${box('Villa Pipeline Projection','',`<table><thead><tr><th>Year</th><th class="right">Villas</th><th class="right">Avg Value</th><th class="right">Revenue</th></tr></thead><tbody>
  ${[{y:'Y1',v:0,avg:'-',r:0},{y:'Y2',v:2,avg:'€5M',r:278000},{y:'Y3',v:7,avg:'€5.5M',r:973000},{y:'Y4',v:15,avg:'€6M',r:2085000},{y:'Y5',v:25,avg:'€6.5M',r:3475000}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold">${d.y}</td><td class="right">${d.v}</td><td class="right">${d.avg}</td><td class="right bold c-accent">${d.r?fmt(d.r):'-'}</td></tr>`).join('')}
  </tbody></table>`)}`;
}

// ========== TAB: 5-YEAR PIPELINE (EXPANDED) ==========
function buildRevenue(){
  return `
  ${box('5-Year Revenue Pipeline','70% sell-through assumption, 10-month marketing cycle, 6-month villa cycle','')}
  <div class="grid-2">
    ${box('Project Mix by Year','',`<div class="chart-container"><canvas id="revMixChart"></canvas></div>`)}
    ${box('Revenue & EBITDA Growth','',`<div class="chart-container"><canvas id="revMarginChart"></canvas></div>`)}
  </div>
  ${fiveYear.map((d,i)=>`${box(d.year+' — '+d.projects+' Projects','',`
    <p>${['Build case studies. Small-to-medium developments. Mix: 3 Small, 2 Medium. Focus on Costa del Sol and Balearics. Founder handles all sales personally.',
    'Enter luxury villas. Expand to second market (UK or Portugal). Mix: 7S, 5M, 1L, 2V. First dedicated BD hire starts building pipeline.',
    'Inflection point. Multi-market presence across 3+ countries. Mix: 18S, 20M, 5L, 7V. Department heads in place. ~1 launch per week.',
    'Market leadership phase. ~2 launches per week. Mix: 30S, 40M, 15L, 15V. Regional structure. Full C-Suite. White-label discussions begin.',
    'European leader. ~3 launches per week. Mix: 40S, 55M, 30L, 25V. Platform as standalone product. Three regional hubs. 95 people.'][i]}</p>
    <div class="grid-4">
      <div style="background:var(--accentSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;font-weight:600" class="c-light">REVENUE</div><div style="font-size:20px;font-weight:700" class="c-accent">${fmt(d.revenue)}</div></div>
      <div style="background:var(--warmSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;font-weight:600" class="c-light">EBITDA</div><div style="font-size:20px;font-weight:700" class="c-warm">${fmt(d.ebitda)}</div></div>
      <div style="background:var(--navySoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;font-weight:600" class="c-light">MARGIN</div><div style="font-size:20px;font-weight:700" class="c-navy">${d.margin}%</div></div>
      <div style="background:var(--coralSoft);border-radius:8px;padding:10px 14px"><div style="font-size:10px;font-weight:600" class="c-light">SUCCESS FEES</div><div style="font-size:20px;font-weight:700" class="c-coral">${fmt(d.successFees)}</div></div>
    </div>
  `,'border-left:4px solid var(--'+['accent','warm','navy','coral','plum'][i]+')')}`).join('')}
  ${box('Revenue Stream Breakdown','',fiveYearTable())}`;
}

// ========== TAB: TEAM / COSTS (FULL YEAR-BY-YEAR) ==========
function buildTeam(){
  const yrs=[
    {yr:"Year 1",sub:"Foundation — 5 Projects",total:4,cost:"€400K",out:"€20K",rev:"€572K",c:'accent',
      depts:[{n:"Leadership",c:C.sand,ct:1,r:[["Founder / CEO (you)","Full-time","€60-80K"]]},{n:"Creative / Renders",c:C.coral,ct:1,r:[["AI Render Specialist / Creative Director","Full-time","€45-55K"]]},{n:"Marketing",c:C.warm,ct:1,r:[["Performance Marketing Manager","Full-time","€40-50K"]]},{n:"Technology",c:C.plum,ct:1,r:[["Full-Stack Developer (Platform)","Full-time","€50-65K"]]}],
      outs:["Legal / Accounting","Copywriting (overflow)","3D Modelling (complex)","Video Editing","PR / Media Relations","Print Design"],
      note:"Lean founding team. You handle sales, strategy, and clients. AI Render Specialist also does branding. Marketing Manager also does social/email. Developer builds MVP. All 4 can deliver 5 projects."},
    {yr:"Year 2",sub:"Growth — 15 Projects",total:10,cost:"€1.09M",out:"€100K",rev:"€690K",c:'warm',
      depts:[{n:"Leadership",c:C.sand,ct:2,r:[["Founder / CEO","Full-time","€80-100K"],["COO / Operations Director","Full-time","€65-80K"]]},{n:"Account Management",c:C.accent,ct:2,r:[["Senior Account Manager","Full-time","€45-55K"],["Junior Account Manager","Full-time","€30-38K"]]},{n:"Creative",c:C.coral,ct:2,r:[["Creative Director","Full-time","€50-60K"],["AI Render Artist","Full-time","€38-45K"]]},{n:"Marketing",c:C.warm,ct:2,r:[["Head of Performance Marketing","Full-time","€50-60K"],["Social / Content Manager","Full-time","€32-40K"]]},{n:"Technology",c:C.plum,ct:1,r:[["Lead Developer","Full-time","€55-70K"]]},{n:"Sales / BD",c:C.navy,ct:1,r:[["BD Manager","Full-time","€45-55K + comm"]]}],
      outs:["Legal / Accounting","3D Modelling (specialist)","Video Production","PR Agency (per-project)","Multilingual Copywriting","Print Design","SEO","Photography"],
      note:"First real hires. AMs free up founder. COO handles ops/HR/finance. BD Manager builds Y3 pipeline. Each AM handles 5-8 projects."},
    {yr:"Year 3",sub:"Inflection Point — 50 Projects",total:30,cost:"€3.35M",out:"€400K",rev:"€856K",c:'navy',
      depts:[{n:"Leadership",c:C.sand,ct:3,r:[["CEO","Full-time","€100-130K"],["COO","Full-time","€80-100K"],["CFO (fractional)","Part-time","€40-50K"]]},{n:"Account Management",c:C.accent,ct:10,r:[["Head of Client Services","Full-time","€65-80K"],["Senior AMs (x3)","Full-time","€50-60K ea"],["Account Managers (x4)","Full-time","€38-45K ea"],["Coordinators (x2)","Full-time","€28-33K ea"]]},{n:"Creative",c:C.coral,ct:5,r:[["Creative Director","Full-time","€60-75K"],["Senior AI Artists (x2)","Full-time","€45-55K ea"],["Junior Artists (x2)","Full-time","€30-38K ea"]]},{n:"Marketing",c:C.warm,ct:5,r:[["Head of Marketing","Full-time","€60-75K"],["Performance Mgrs (x2)","Full-time","€45-55K ea"],["Content / Social (x2)","Full-time","€32-40K ea"]]},{n:"Technology",c:C.plum,ct:3,r:[["CTO","Full-time","€75-95K"],["Full-Stack Dev","Full-time","€55-70K"],["Junior Dev","Full-time","€35-45K"]]},{n:"Sales / BD",c:C.navy,ct:2,r:[["Head of Sales","Full-time","€65-80K + comm"],["BD Manager (Market 2)","Full-time","€50-60K + comm"]]},{n:"Operations",c:C.stone,ct:2,r:[["Ops Manager","Full-time","€35-42K"],["HR / Admin","Full-time","€28-35K"]]}],
      outs:["Legal (multi-jurisdiction)","Accounting / Tax","3D Modelling (overflow)","Video Production","PR Agencies (per market)","Multilingual Copywriters","Photography","Print","QA / Testing","Market Research"],
      note:"The inflection point. Department heads in place. AM is the biggest dept (5-6 projects each). Second-market BD person. Freelancer spend triples. CTO leads platform full-time."},
    {yr:"Year 4",sub:"Market Leadership — 100 Projects",total:60,cost:"€6.5M",out:"€750K",rev:"€917K",c:'coral',
      depts:[{n:"C-Suite",c:C.sand,ct:5,r:[["CEO","Full-time","€130-160K"],["COO","Full-time","€100-120K"],["CFO","Full-time","€85-100K"],["CTO","Full-time","€95-120K"],["CRO","Full-time","€90-110K + bonus"]]},{n:"Account Management",c:C.accent,ct:20,r:[["VP Client Services","Full-time","€80-100K"],["Regional Heads (x2)","Full-time","€65-80K ea"],["Senior AMs (x6)","Full-time","€50-60K ea"],["AMs (x7)","Full-time","€38-48K ea"],["Coordinators (x4)","Full-time","€28-35K ea"]]},{n:"Creative Studio",c:C.coral,ct:10,r:[["VP Creative","Full-time","€75-90K"],["Lead Artist","Full-time","€55-65K"],["Senior AI Artists (x3)","Full-time","€45-55K ea"],["Artists (x3)","Full-time","€35-42K ea"],["Brand Designers (x2)","Full-time","€38-45K ea"]]},{n:"Marketing",c:C.warm,ct:10,r:[["VP Marketing","Full-time","€75-90K"],["Head of Performance","Full-time","€60-70K"],["Performance (x3)","Full-time","€42-52K ea"],["Content (x3)","Full-time","€35-42K ea"],["Email/CRM (x2)","Full-time","€35-42K ea"]]},{n:"Technology",c:C.plum,ct:6,r:[["Senior Engineers (x2)","Full-time","€60-80K ea"],["Mid Engineers (x2)","Full-time","€45-60K ea"],["QA Engineer","Full-time","€38-48K"],["DevOps","Full-time","€50-65K"]]},{n:"Sales",c:C.navy,ct:5,r:[["Regional Sales Mgrs (x2)","Full-time","€55-70K + comm"],["BD Managers (x2)","Full-time","€45-55K + comm"],["Sales Support","Full-time","€30-38K"]]},{n:"Ops / Finance",c:C.stone,ct:4,r:[["Head of Ops","Full-time","€55-65K"],["Financial Controller","Full-time","€50-60K"],["HR Manager","Full-time","€42-50K"],["Office Admin","Full-time","€28-35K"]]}],
      outs:["Law Firms (3-4 jurisdictions)","Big-4 Accounting","Video Production","PR Agencies","Copywriters (5+ languages)","Photography","3D Modellers","Translation","Recruitment","IT Security Audit"],
      note:"Two launches/week. Regional structure: Iberia + Northern Europe. Full C-Suite. Extensive freelancer network managed by Ops."},
    {yr:"Year 5",sub:"European Leader — 150 Projects",total:95,cost:"€10.44M",out:"€1.2M",rev:"€902K",c:'plum',
      depts:[{n:"C-Suite",c:C.sand,ct:6,r:[["CEO","Full-time","€160-200K"],["COO","Full-time","€120-140K"],["CFO","Full-time","€100-120K"],["CTO","Full-time","€110-130K"],["CRO","Full-time","€100-130K + bonus"],["CMO","Full-time","€95-120K"]]},{n:"Account Management",c:C.accent,ct:32,r:[["SVP Client Services","Full-time","€100-120K"],["Regional Heads (x3)","Full-time","€75-90K ea"],["Senior AMs (x10)","Full-time","€55-65K ea"],["AMs (x12)","Full-time","€40-50K ea"],["Juniors (x6)","Full-time","€28-35K ea"]]},{n:"Creative Studio",c:C.coral,ct:16,r:[["VP Creative","Full-time","€85-100K"],["Lead Artists (x2)","Full-time","€60-70K ea"],["Senior AI Artists (x5)","Full-time","€48-58K ea"],["Artists (x4)","Full-time","€35-42K ea"],["Brand Designers (x2)","Full-time","€40-48K ea"],["Motion / Video (x2)","Full-time","€42-52K ea"]]},{n:"Marketing",c:C.warm,ct:16,r:[["Head of Performance","Full-time","€70-85K"],["Head of Content","Full-time","€60-72K"],["Senior Performance (x4)","Full-time","€48-58K ea"],["Performance (x3)","Full-time","€38-45K ea"],["Content / Social (x4)","Full-time","€35-42K ea"],["Email/CRM/Auto (x3)","Full-time","€38-45K ea"]]},{n:"Technology",c:C.plum,ct:10,r:[["VP Engineering","Full-time","€85-100K"],["Senior Engineers (x3)","Full-time","€65-85K ea"],["Mid Engineers (x3)","Full-time","€48-62K ea"],["QA","Full-time","€40-50K"],["DevOps","Full-time","€55-70K"],["Product Manager","Full-time","€60-75K"]]},{n:"Sales",c:C.navy,ct:8,r:[["VP Sales","Full-time","€80-95K"],["Regional Sales (x3)","Full-time","€58-72K + comm"],["BD Managers (x2)","Full-time","€48-58K + comm"],["Sales Support (x2)","Full-time","€32-40K ea"]]},{n:"Ops / Finance / HR",c:C.stone,ct:7,r:[["Head of Finance","Full-time","€65-80K"],["Financial Controller","Full-time","€52-62K"],["Head of HR","Full-time","€55-65K"],["HR Coordinator","Full-time","€32-40K"],["Office Manager","Full-time","€30-38K"],["Legal Counsel","Full-time","€70-85K"]]}],
      outs:["International Law Firms (5+)","Big-4 Audit / Tax","Video Production (per market)","PR Agencies (per market)","Translators (8+ languages)","Photography","3D Modellers","Print Houses","Penetration Testing","Executive Recruitment","Market Entry Consultants"],
      note:"Three launches/week. Three regional hubs. Platform is a white-label product. In-house legal. Product Manager evolves platform. CMO added. Freelancer network spans 8+ countries."}
  ];
  function yrCard(y){
    return '<div class="box left-border '+y.c+'-border" style="margin-bottom:20px"><div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;margin-bottom:16px"><div><div style="font-family:var(--display);font-size:18px;font-weight:700" class="c-'+y.c+'">'+y.yr+'</div><div style="font-size:12px" class="c-muted">'+y.sub+'</div></div><div style="display:flex;gap:10px;flex-wrap:wrap"><div style="background:var(--cardAlt);border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">TEAM</div><div style="font-size:20px;font-weight:700" class="c-'+y.c+'">'+y.total+'</div></div><div style="background:var(--cardAlt);border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">TOTAL COST</div><div style="font-size:16px;font-weight:700">'+y.cost+'</div></div><div style="background:var(--cardAlt);border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">OUTSOURCE</div><div style="font-size:16px;font-weight:700">'+y.out+'</div></div><div style="background:var(--cardAlt);border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:10px;font-weight:600" class="c-light">REV/HEAD</div><div style="font-size:16px;font-weight:700">'+y.rev+'</div></div></div></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;margin-bottom:16px">'+y.depts.map(function(d){return '<div class="dept-card" style="border-left:4px solid '+d.c+'"><div class="dept-header"><div class="dept-name" style="color:'+d.c+'">'+d.n+'</div><div class="dept-count">'+d.ct+'</div></div>'+d.r.map(function(r){return '<div class="role-row"><div style="display:flex;align-items:center;gap:8px"><span class="role-dot" style="background:var(--accent)"></span><span style="font-size:13px">'+r[0]+'</span></div><div style="display:flex;gap:8px;align-items:center"><span class="role-badge" style="background:var(--accentSoft);color:var(--accent)">'+r[1]+'</span><span class="role-salary">'+r[2]+'</span></div></div>';}).join('')+'</div>';}).join('')+'</div><div style="margin-bottom:12px"><div style="font-weight:700;font-size:12px;color:var(--plum);margin-bottom:6px">Outsourced:</div><div style="display:flex;flex-wrap:wrap;gap:6px">'+y.outs.map(function(o){return '<span class="pill plum">'+o+'</span>';}).join('')+'</div></div><p style="font-size:12px;color:var(--textMuted);margin:0"><strong>Note:</strong> '+y.note+'</p></div>';
  }
  return `
  ${box('Team Structure / Costs','Year-by-year org breakdown with every role, department, salary, and outsourcing strategy',`<p>The team scales from <strong>4 people in Year 1 to 95 in Year 5</strong>. Core team stays lean; AI + outsourcing handles variable workload. Account Management is always the largest department because every active project needs a dedicated point of contact.</p>`)}
  <div class="kpi-grid">${kpi('Y1 Team','4','€400K total',C.accent)}${kpi('Y2 Team','10','€1.09M total',C.warm)}${kpi('Y3 Team','30','€3.35M total',C.navy)}${kpi('Y4 Team','60','€6.5M total',C.coral)}${kpi('Y5 Team','95','€10.44M total',C.plum)}</div>
  <div class="grid-2">${box('Team by Department','',`<div class="chart-container"><canvas id="teamScaleChart"></canvas></div>`)}${box('Cost Breakdown','',`<div class="chart-container"><canvas id="teamCostChart"></canvas></div>`)}</div>
  ${yrs.map(function(y){return yrCard(y);}).join('')}
  ${box('Breakeven Analysis','',`
    <p>With Y1 costs of just <strong>€400K</strong>, only <strong>~1 project</strong> needed to breakeven. Cash-flow positive by Month 3. Safety multiple of 5-8x every year.</p>
    <div class="kpi-grid">${kpi('Y1 Breakeven','~1 project','Month 3 cash+',C.accent)}${kpi('Y1 Profit',fmt(1887000),'83% margin',C.warm)}${kpi('5-Yr Cum. Profit',fmt(153864000),'88% avg margin',C.navy)}${kpi('Cost/Revenue','12%','Y5 (from 17% Y1)',C.coral)}${kpi('Y5 Breakeven','~18 projects','Of 150 total',C.plum)}</div>
    <div class="grid-2">${box('Revenue vs Costs','',`<div class="chart-container"><canvas id="teamBeChart"></canvas></div>`)}${box('BE Projects vs Actual','',`<div class="chart-container"><canvas id="teamBeProjectsChart"></canvas></div>`)}</div>
    <table><thead><tr><th>Year</th><th class="right">Revenue</th><th class="right">Costs</th><th class="right">EBITDA</th><th class="right">Margin</th><th class="right">BE Proj</th><th class="right">Actual</th><th class="right">Safety</th></tr></thead><tbody>
    ${[{yr:'Y1',rev:2287000,cost:400000,ebitda:1887000,m:'83%',be:'~1',a:5,s:'5.0x'},{yr:'Y2',rev:6900000,cost:1090000,ebitda:5810000,m:'84%',be:'~2',a:15,s:'7.5x'},{yr:'Y3',rev:25684000,cost:3350000,ebitda:22334000,m:'87%',be:'~7',a:50,s:'7.1x'},{yr:'Y4',rev:55040000,cost:6500000,ebitda:48540000,m:'88%',be:'~12',a:100,s:'8.3x'},{yr:'Y5',rev:85733000,cost:10440000,ebitda:75293000,m:'88%',be:'~18',a:150,s:'8.3x'}].map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold">${d.yr}</td><td class="right bold c-accent">${fmt(d.rev)}</td><td class="right c-coral">${fmt(d.cost)}</td><td class="right bold">${fmt(d.ebitda)}</td><td class="right bold c-accent">${d.m}</td><td class="right c-coral">${d.be}</td><td class="right bold">${d.a}</td><td class="right bold c-accent">${d.s}</td></tr>`).join('')}
    </tbody></table>
  `)}
  ${box('Why Margins Expand','',`<div class="grid-3">${[{t:'Near-Zero Marginal Cost',c:'accent',p:'Success fees (84-85%) cost nothing extra to earn. Every unit sale = pure commission.'},{t:'AI Replaces Headcount',c:'warm',p:'3-5x more output per person than traditional agencies. AI handles renders, copy, ads, email.'},{t:'Platform Leverage',c:'coral',p:'Built once, deployed everywhere. <€500/yr per project hosting. SaaS economics on agency model.'}].map(d=>`<div style="background:var(--${d.c}Soft);border-radius:10px;padding:16px"><div style="font-weight:700;font-size:14px;margin-bottom:6px" class="c-${d.c}">${d.t}</div><p>${d.p}</p></div>`).join('')}</div>`)}`;
}

// ========== TAB: MARKETS / ROADMAP (EXPANDED) ==========
function buildMarket(){
  return `
  ${box('European Market Considerations','',`<p>European off-plan marketing is served by traditional agencies charging €50K-200K+ without tech platforms. The interactive sales platform is a genuine differentiator that no competitor currently offers.</p>`)}
  <div class="grid-2">
    ${box('Target Markets (Priority Order)','',`<ul class="ul"><li><strong>Spain</strong> (Costa del Sol, Barcelona, Madrid, Balearics)</li><li><strong>Portugal</strong> (Lisbon, Algarve, Porto)</li><li><strong>UK</strong> (London, Manchester, regional)</li><li><strong>Germany</strong> (Berlin, Munich, Hamburg)</li><li><strong>Nordics</strong> (Stockholm, Copenhagen)</li><li><strong>France</strong> (Riviera, Paris)</li><li><strong>Greece / Cyprus</strong></li><li><strong>Dubai / Middle East</strong> (expansion)</li></ul>`,'border-left:4px solid var(--accent)')}
    ${box('Legal / Compliance','',`<ul class="ul"><li>GDPR compliance essential from Day 1</li><li>Country-specific off-plan regulations (VEFA France, LOE Spain)</li><li>AML checks for deposit collection via platform</li><li>Tax-efficient EU jurisdiction (likely Spain or Portugal)</li><li>VAT treatment varies by country</li><li>Multi-currency payment processing</li><li>Data residency requirements per market</li></ul>`,'border-left:4px solid var(--coral)')}
  </div>
  ${box('Year 1 Roadmap','',`
    <div class="grid-4">
      ${[{p:'Month 1-2',t:'Foundation',c:'accent',items:['Build platform MVP','Set up AI render pipeline','Create brand and website','Establish legal entity','Open bank accounts, Stripe setup']},{p:'Month 3-4',t:'First Client',c:'warm',items:['Target 1-2 pilot developers in Costa del Sol','Deliver full package using AI','Document results as case studies','First success fee invoiced']},{p:'Month 5-8',t:'Growth',c:'navy',items:['Pitch 3-5 more developers','Refine platform based on feedback','Build investor database','Hire 1-2 people','Second market research']},{p:'Month 9-12',t:'Scale',c:'coral',items:['Expand to second market (UK or PT)','Productise SaaS platform','White-label partnership discussions','Target 8-12 total projects','Hire to team of 4-6']}].map(d=>`<div class="stat-card ${d.c}-top"><div style="font-size:11px;font-weight:600" class="c-${d.c}">${d.p}</div><div style="font-size:14px;font-weight:700;margin:4px 0">${d.t}</div><ul class="ul">${d.items.map(i=>`<li style="font-size:11px">${i}</li>`).join('')}</ul></div>`).join('')}
    </div>
  `)}
  ${box('Risk Mitigation','',`
    <div class="grid-3">
      ${[{risk:'Market Downturn',mit:'Multi-market diversification (4+ countries by Y3). Developers need MORE marketing in slow markets. Low costs = profitable even at 50% volume.',c:'coral'},{risk:'Competitor Threat',mit:'First-mover in each market. Investor database moat. Platform IP creates switching costs. Traditional agencies too slow to pivot to AI.',c:'navy'},{risk:'AI Quality Risk',mit:'Human QA on every deliverable. AI produces 80%, skilled artists refine. 2 revision rounds included. Indistinguishable from traditional CGI.',c:'plum'},{risk:'Key Person Risk',mit:'COO hired Y2. SOPs documented from Day 1. Platform automates workflows. By Y3, dept heads run independently.',c:'accent'},{risk:'Slow Sales Velocity',mit:'Retainer revenue provides baseline. Real-time platform data identifies issues early. Success fee alignment = equally motivated.',c:'warm'},{risk:'Non-Payment',mit:'Success fees tied to verified platform sales with audit trail. Onboarding covers delivery costs. Can pause if payment late.',c:'sand'}].map(d=>`<div class="stat-card" style="border-left:3px solid var(--${d.c})"><div style="font-weight:700;font-size:12px;margin-bottom:4px" class="c-${d.c}">${d.risk}</div><p style="font-size:11px;margin:0">${d.mit}</p></div>`).join('')}
    </div>
  `)}`;
}

// ========== TAB: SCENARIOS (EXPANDED) ==========
function buildScenarios(){
  return `
  <div class="kpi-grid">
    ${kpi('Bull Case (Y5)',fmt(101311000),'85% sell-through',C.accent)}
    ${kpi('Base Case (Y5)',fmt(85733000),'70% sell-through',C.warm)}
    ${kpi('Bear Case (Y5)',fmt(64962000),'50% sell-through',C.coral)}
  </div>
  ${box('Sensitivity Analysis','Revenue scenarios based on sell-through rates',`<div class="chart-container"><canvas id="scenarioChart"></canvas></div>`)}
  ${box('5-Year Sensitivity Table','',`
    <table><thead><tr><th>Year</th><th class="right">Bull (85%)</th><th class="right">Base (70%)</th><th class="right">Bear (50%)</th></tr></thead><tbody>
    ${sensitivity.map((d,i)=>`<tr class="${i%2?'alt':''}"><td class="bold">${d.year}</td><td class="right bold c-accent">${fmt(d.bull)}</td><td class="right bold c-warm">${fmt(d.base)}</td><td class="right bold c-coral">${fmt(d.bear)}</td></tr>`).join('')}
    </tbody></table>
  `)}
  ${box('Valuation Scenarios','',`
    <div class="grid-3" style="margin-bottom:20px">
      ${[{l:'Conservative',m:'6x EBITDA on Y3',v:'€134M',c:C.coral},{l:'Mid-Range',m:'10x EBITDA on Y5',v:'€753M',c:C.warm},{l:'Premium',m:'15x EBITDA on Y5',v:'€1.13B',c:C.accent}].map(v=>`<div style="background:#fff;border:1px solid var(--border);border-radius:10px;padding:20px;text-align:center"><div style="font-size:12px;font-weight:600;text-transform:uppercase" class="c-light">${v.l}</div><div style="font-size:32px;font-weight:700;color:${v.c};margin:8px 0">${v.v}</div><div style="font-size:12px" class="c-muted">${v.m}</div></div>`).join('')}
    </div>
    <p>Comparable proptech businesses trade at 8-15x EBITDA, implying <strong>€753M-1.13B enterprise value</strong> at Year 5. Even the bear case generates €65M Y5 revenue — still highly profitable.</p>
  `)}
  ${box('Important Notes','',`
    <div class="grid-2">
      ${[{t:'Cash Flow Timing',c:'accent',p:'Success fees collected over 6-18 months as units sell. 60-70% recognised in the same financial year as the development launches.'},{t:'Market Risks',c:'coral',p:'European property markets are cyclical. Geographic diversification across 4+ markets mitigates country-specific downturns.'},{t:'AI Cost Advantage',c:'warm',p:'Breakeven at just 1 project in Y1. Business remains profitable even in bear case (50% sell-through) due to low cost base.'},{t:'Scaling Assumptions',c:'navy',p:'5 to 150 projects requires disciplined execution and expansion into 1-2 new markets per year. Pipeline visibility via retainer model helps planning.'}].map(n=>`<div><div style="font-weight:700;font-size:14px;margin-bottom:6px" class="c-${n.c}">${n.t}</div><p>${n.p}</p></div>`).join('')}
    </div>
  `)}`;
}

function renderExecCharts(){
  createChart('execGrowthChart',{type:'bar',data:{labels:fiveYear.map(d=>d.year),datasets:[{label:'Revenue',data:fiveYear.map(d=>d.revenue),backgroundColor:C.accent+'CC',borderRadius:4},{label:'EBITDA',data:fiveYear.map(d=>d.ebitda),backgroundColor:C.warm+'CC',borderRadius:4},{label:'Costs',data:fiveYear.map(d=>d.costs),backgroundColor:C.coral+'CC',borderRadius:4}]},options:{...chartDefaults}});

  const cumR=[],cumE=[];let cr=0,ce=0;
  fiveYear.forEach(d=>{cr+=d.revenue;ce+=d.ebitda;cumR.push(cr);cumE.push(ce);});
  createChart('execCumChart',{type:'line',data:{labels:fiveYear.map(d=>d.year),datasets:[{label:'Cum. Revenue',data:cumR,borderColor:C.accent,backgroundColor:C.accent+'22',fill:true,tension:0.3},{label:'Cum. EBITDA',data:cumE,borderColor:C.warm,backgroundColor:C.warm+'22',fill:true,tension:0.3}]},options:{...chartDefaults}});

  createChart('execStreamsChart',{type:'bar',data:{labels:fiveYear.map(d=>d.yr),datasets:[{label:'Success Fees',data:fiveYear.map(d=>d.successFees),backgroundColor:P[0]},{label:'Retainers',data:fiveYear.map(d=>d.retainer),backgroundColor:P[1]},{label:'Onboarding',data:fiveYear.map(d=>d.onboarding),backgroundColor:P[2]},{label:'SaaS',data:fiveYear.map(d=>d.saas),backgroundColor:P[3]},{label:'Media',data:fiveYear.map(d=>d.mediaMgmt),backgroundColor:P[4]}]},options:{...chartDefaults,scales:{...chartDefaults.scales,x:{...chartDefaults.scales.x,stacked:true},y:{...chartDefaults.scales.y,stacked:true}}}});

  createChart('execMixChart',{type:'bar',data:{labels:projectMix.map(d=>d.year),datasets:[{label:'Small (800K)',data:projectMix.map(d=>d.small),backgroundColor:P[0]},{label:'Medium (750K)',data:projectMix.map(d=>d.medium),backgroundColor:P[1]},{label:'Large (500K)',data:projectMix.map(d=>d.large),backgroundColor:P[2]},{label:'Villas (5M+)',data:projectMix.map(d=>d.villa),backgroundColor:P[3]}]},options:{...chartDefaults,scales:{...chartDefaults.scales,x:{...chartDefaults.scales.x,stacked:true},y:{...chartDefaults.scales.y,stacked:true,ticks:{...chartDefaults.scales.y.ticks,callback:v=>v}}}}});

  createChart('execTeamChart',{type:'bar',data:{labels:teamData.map(d=>d.year),datasets:[{label:'Acct Mgmt',data:teamData.map(d=>d.AcctMgmt),backgroundColor:P[0]},{label:'Creative',data:teamData.map(d=>d.Creative),backgroundColor:P[1]},{label:'Marketing',data:teamData.map(d=>d.Marketing),backgroundColor:P[2]},{label:'Tech',data:teamData.map(d=>d.Tech),backgroundColor:P[3]},{label:'Sales',data:teamData.map(d=>d.Sales),backgroundColor:P[4]},{label:'Leadership',data:teamData.map(d=>d.Leadership),backgroundColor:P[5]},{label:'Ops',data:teamData.map(d=>d.Ops),backgroundColor:P[6]}]},options:{...chartDefaults,scales:{...chartDefaults.scales,x:{...chartDefaults.scales.x,stacked:true},y:{...chartDefaults.scales.y,stacked:true,ticks:{...chartDefaults.scales.y.ticks,callback:v=>v}}}}});

  createChart('execSensChart',{type:'line',data:{labels:sensitivity.map(d=>d.year),datasets:[{label:'Bull (85%)',data:sensitivity.map(d=>d.bull),borderColor:C.accent,borderWidth:2,tension:0.3},{label:'Base (70%)',data:sensitivity.map(d=>d.base),borderColor:C.warm,borderWidth:2,tension:0.3},{label:'Bear (50%)',data:sensitivity.map(d=>d.bear),borderColor:C.coral,borderWidth:2,tension:0.3}]},options:{...chartDefaults}});
}

function renderResearchCharts(){
  createChart('researchBarChart',{type:'bar',data:{labels:['Spain','UK','Germany','Sweden'],datasets:[{label:'New-Build Sales',data:[135052,180700,215900,30000],backgroundColor:C.accent+'99'},{label:'Housing Starts',data:[112220,180700,215900,22200],backgroundColor:C.warm+'99'},{label:'Est. Premium Units',data:[47500,36000,27500,5250],backgroundColor:C.coral}]},options:{...chartDefaults}});

  createChart('researchPieChart',{type:'doughnut',data:{labels:['Spain: 1,150','UK: 750','Germany: 600','Sweden: 200'],datasets:[{data:[1150,750,600,200],backgroundColor:[P[0],P[1],P[2],P[3]],borderWidth:2,borderColor:'#FFFFFF'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{font:{family:'DM Sans',size:11},usePointStyle:true,padding:16}}}}});
}

function renderModelCharts(){
  createChart('modelStreamsChart',{type:'bar',data:{labels:fiveYear.map(d=>d.yr),datasets:[{label:'Success Fees',data:fiveYear.map(d=>d.successFees),backgroundColor:P[0]},{label:'Retainers',data:fiveYear.map(d=>d.retainer),backgroundColor:P[1]},{label:'Onboarding',data:fiveYear.map(d=>d.onboarding),backgroundColor:P[2]},{label:'SaaS',data:fiveYear.map(d=>d.saas),backgroundColor:P[3]},{label:'Media',data:fiveYear.map(d=>d.mediaMgmt),backgroundColor:P[4]}]},options:{...chartDefaults,scales:{...chartDefaults.scales,x:{...chartDefaults.scales.x,stacked:true},y:{...chartDefaults.scales.y,stacked:true}}}});
}

function renderRevenueCharts(){
  createChart('revMixChart',{type:'bar',data:{labels:projectMix.map(d=>d.year),datasets:[{label:'Small',data:projectMix.map(d=>d.small),backgroundColor:P[0]},{label:'Medium',data:projectMix.map(d=>d.medium),backgroundColor:P[1]},{label:'Large',data:projectMix.map(d=>d.large),backgroundColor:P[2]},{label:'Villas',data:projectMix.map(d=>d.villa),backgroundColor:P[3]}]},options:{...chartDefaults,scales:{...chartDefaults.scales,x:{...chartDefaults.scales.x,stacked:true},y:{...chartDefaults.scales.y,stacked:true,ticks:{...chartDefaults.scales.y.ticks,callback:v=>v}}}}});

  createChart('revMarginChart',{type:'bar',data:{labels:fiveYear.map(d=>d.year),datasets:[{label:'Revenue',data:fiveYear.map(d=>d.revenue),backgroundColor:C.accent+'44',borderRadius:4},{label:'EBITDA',data:fiveYear.map(d=>d.ebitda),backgroundColor:C.warm,borderRadius:4}]},options:{...chartDefaults}});
}

function renderTeamCharts(){
  createChart('teamScaleChart',{type:'bar',data:{labels:teamData.map(d=>d.year),datasets:[{label:'Acct Mgmt',data:teamData.map(d=>d.AcctMgmt),backgroundColor:P[0]},{label:'Creative',data:teamData.map(d=>d.Creative),backgroundColor:P[1]},{label:'Marketing',data:teamData.map(d=>d.Marketing),backgroundColor:P[2]},{label:'Tech',data:teamData.map(d=>d.Tech),backgroundColor:P[3]},{label:'Sales',data:teamData.map(d=>d.Sales),backgroundColor:P[4]},{label:'Leadership',data:teamData.map(d=>d.Leadership),backgroundColor:P[5]},{label:'Ops',data:teamData.map(d=>d.Ops),backgroundColor:P[6]}]},options:{...chartDefaults,scales:{...chartDefaults.scales,x:{...chartDefaults.scales.x,stacked:true},y:{...chartDefaults.scales.y,stacked:true,ticks:{...chartDefaults.scales.y.ticks,callback:v=>v}}}}});

  createChart('teamCostChart',{type:'bar',data:{labels:costBreak.map(d=>d.year),datasets:[{label:'Team',data:costBreak.map(d=>d.Team),backgroundColor:P[0]},{label:'Freelancers',data:costBreak.map(d=>d.Freelancers),backgroundColor:P[1]},{label:'Operations',data:costBreak.map(d=>d.Operations),backgroundColor:P[2]},{label:'AI Tools',data:costBreak.map(d=>d.AITools),backgroundColor:P[3]},{label:'Hosting',data:costBreak.map(d=>d.Hosting),backgroundColor:P[4]}]},options:{...chartDefaults,scales:{...chartDefaults.scales,x:{...chartDefaults.scales.x,stacked:true},y:{...chartDefaults.scales.y,stacked:true}}}});

  createChart('teamBeChart',{type:'bar',data:{labels:beData.map(d=>d.yr),datasets:[{label:'Revenue',data:beData.map(d=>d.revenue),backgroundColor:C.accent+'CC',borderRadius:4},{label:'Total Costs',data:beData.map(d=>d.costs),backgroundColor:C.coral+'CC',borderRadius:4}]},options:{...chartDefaults}});

  createChart('teamBeProjectsChart',{type:'bar',data:{labels:beData.map(d=>d.yr),datasets:[{label:'Actual Projects',data:beData.map(d=>d.projects),backgroundColor:C.accent+'99',borderRadius:4},{label:'Breakeven Projects',data:beData.map(d=>d.beProjects),backgroundColor:C.coral,borderRadius:4}]},options:{...chartDefaults,scales:{...chartDefaults.scales,y:{...chartDefaults.scales.y,ticks:{...chartDefaults.scales.y.ticks,callback:v=>v}}}}});
}

function renderScenarioCharts(){
  createChart('scenarioChart',{type:'line',data:{labels:sensitivity.map(d=>d.year),datasets:[{label:'Bull (85%)',data:sensitivity.map(d=>d.bull),borderColor:C.accent,borderWidth:3,pointRadius:5,tension:0.3},{label:'Base (70%)',data:sensitivity.map(d=>d.base),borderColor:C.warm,borderWidth:3,pointRadius:5,tension:0.3},{label:'Bear (50%)',data:sensitivity.map(d=>d.bear),borderColor:C.coral,borderWidth:3,pointRadius:5,tension:0.3}]},options:{...chartDefaults}});
}

// Init on load if not auto-logged
if(document.getElementById('dashboard').classList.contains('visible')){
  document.addEventListener('DOMContentLoaded',initDashboard);
}
</script>
</body>
</html>
